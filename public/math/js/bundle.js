!function(){"use strict";class e{static CheckFruit(n,a){return n==e.FruitType&&a.x>=160&&a.x<=410&&a.y>=600&&a.y<=700}static GetFruitType(e){switch(e){case"apple":return 0;case"peach":return 1;case"mango":return 2;case"orange":return 3;case"dragon":return 4;case"strawberry":return 5;default:return 0}}}e.HomeScene="home.scene",e.MainScene="main.scene",e.OverScene="over.scene",e.MaxCount=6,e.counter=0,e.titles=["小朋友，请你帮朱迪按照购物清单买水果吧。","小朋友，请你帮鲍比按照购物清单买水果吧。"],e.sounds=["audios/judy.mp3","audios/bear.mp3"],e.wrongSound="audios/wrong.mp3",e.numSounds=["audios/num1.mp3","audios/num2.mp3","audios/num3.mp3"],e.successSound="audios/success.mp3",e.fruitImgs=["image/main/apple1.png","image/main/peach1.png","image/main/mango1.png","image/main/orange1.png","image/main/dragon1.png","image/main/strawberry1.png"],e.numberImgs=["image/main/number1.png","image/main/number2.png","image/main/number3.png"],e.pointNormal="image/main/point1.png",e.pointHigh="image/main/point2.png",e.ChactorType=0,e.FruitType=0,e.FruitCount=0,e.Success="Success",e.Increase="Increase",e.NextStep="NextStep";class n{constructor(){Laya.loader.load("res/atlas/bear_win.atlas",Laya.Handler.create(this,this.OnBearLoaded)),Laya.loader.load("res/atlas/judy_win.atlas",Laya.Handler.create(this,this.OnJudyLoaded))}static GetInstance(){return null!=this.instance&&null!=this.instance||(this.instance=new n,Laya.stage.on(e.Success,this,this.instance.PlayWinAni)),this.instance}OnBearLoaded(){console.log("Bear  图集加载完成")}OnJudyLoaded(){console.log("Judy 图集加载完成")}PlayWinAni(){let a;Laya.SoundManager.playSound(e.successSound,1),0==e.ChactorType?(null!=n.instance.judyWinAni&&null!=n.instance.judyWinAni||(n.instance.judyWinAni=new Laya.Animation,n.instance.judyWinAni.loadAnimation("judy_win.ani"),n.instance.judyWinAni.on(Laya.Event.COMPLETE,this,n.OnJudyWinPlayed)),a=n.instance.judyWinAni):1==e.ChactorType&&(null!=n.instance.bearWinAni&&null!=n.instance.bearWinAni||(n.instance.bearWinAni=new Laya.Animation,n.instance.bearWinAni.loadAnimation("bear_win.ani"),n.instance.bearWinAni.on(Laya.Event.COMPLETE,this,n.OnBearWinPlayed)),a=n.instance.bearWinAni),Laya.stage.addChild(a),a.scale(1.5,1.5,!0);let t=a.getComponent(Laya.Widget);null!=t&&null!=t||(t=a.addComponent(Laya.Widget)),t.centerX=0,t.centerY=0,a.zOrder=105,a.play(0,!1)}static OnBearWinPlayed(){Laya.stage.removeChild(n.instance.bearWinAni),Laya.stage.event(e.NextStep)}static OnJudyWinPlayed(){Laya.stage.removeChild(n.instance.judyWinAni),Laya.stage.event(e.NextStep)}}class a extends Laya.Script{constructor(){super(),this.goBtn=null,n.GetInstance()}onAwake(){null!=this.goBtn&&null!=this.goBtn&&this.goBtn.on(Laya.Event.CLICK,this,this.OnHomeClick)}onDisable(){null!=this.goBtn&&null!=this.goBtn&&this.goBtn.offAll()}OnHomeClick(){Laya.Scene.open(e.MainScene)}}class t extends Laya.Script{constructor(){super(),this.fruitImg=null,this.numImg=null,this.counter=0}OnInit(n,a){this.fruitImg.skin=e.fruitImgs[n],this.numImg.skin=e.numberImgs[a-1],this.pointImgs=new Array(a);for(let e=0;e<a;e++)this.pointImgs[e]=this.CreatePoint(e);this.counter=0,Laya.stage.on(e.Increase,this,this.OnIncrease)}CreatePoint(n){let a=new Laya.Image;return a.skin=e.pointNormal,this.owner.addChild(a),a.anchorX=.5,a.anchorY=.5,a.left=60+n*(a.width+10),a.top=170,a}OnIncrease(){Laya.SoundManager.playSound(e.numSounds[this.counter],1),this.pointImgs[this.counter].skin=e.pointHigh,++this.counter>=e.FruitCount&&Laya.stage.event(e.Success)}}class i extends Laya.Script{constructor(){super(),this.maskImg=null,this.titleText=null,this.progressText=null,this.playBtn=null,this.backBtn=null}OnInit(){let n=e.ChactorType;this.progressText.text=e.counter+"/"+e.MaxCount,this.titleText.text=e.titles[n],this.soundUrl=e.sounds[n],this.titleChanel=Laya.SoundManager.playSound(this.soundUrl,1,new Laya.Handler(this,this.OnPlayComplete))}onAwake(){this.playBtn.on(Laya.Event.CLICK,this,this.OnPlayBtnClick),this.backBtn.on(Laya.Event.CLICK,this,this.OnBackBtnClick)}OnPlayComplete(){null!=this.maskImg&&null!=this.maskImg&&this.maskImg.destroy()}OnPlayBtnClick(){null!=this.titleChanel&&(this.titleChanel.isStopped?this.titleChanel=Laya.SoundManager.playSound(this.soundUrl,1):this.titleChanel.resume())}OnBackBtnClick(){null!=this.titleChanel&&this.titleChanel.stop(),Laya.Scene.open(e.HomeScene),e.counter=0}}class s extends Laya.Image{constructor(){super(),this.isFirst=!0,this.on(Laya.Event.MOUSE_DOWN,this,this.OnStartDrag),this.on(Laya.Event.MOUSE_UP,this,this.OnEndDrag)}OnStartDrag(){this.isFirst&&(this.isFirst=!1,this.orginX=this.x,this.orginY=this.y,this.orginOrder=this.zOrder,this.fruitType=e.GetFruitType(this.name)),this.zOrder=100,this.startDrag(this.dragRectangle)}OnEndDrag(){console.log(`X: ${this.x}  Y: ${this.y}`),this.zOrder=this.orginOrder,e.CheckFruit(this.fruitType,new Laya.Point(this.x,this.y))?Laya.stage.event(e.Increase):(Laya.SoundManager.playSound(e.wrongSound,1),Laya.Tween.to(this,{x:this.orginX,y:this.orginY},100))}}class r extends Laya.Script{constructor(){super(),this.title=null,this.order=null,e.counter>e.MaxCount&&(e.counter=0,Laya.Scene.open(e.HomeScene)),e.ChactorType=Math.random()>.5?0:1,Laya.loader.load("res/atlas/bear.atlas",Laya.Handler.create(this,this.OnBearLoaded)),Laya.loader.load("res/atlas/judy.atlas",Laya.Handler.create(this,this.OnJudyLoaded)),e.counter++,this.PlayBgMusic()}OnBearLoaded(){1==e.ChactorType&&this.CreateAni("bear.ani",200,0)}OnJudyLoaded(){0==e.ChactorType&&this.CreateAni("judy.ani",185,-10)}CreateAni(e,n,a){let t=new Laya.Animation;t.loadAnimation(e),this.owner.getChildByName("Canvas").addChild(t),t.scale(1.9,1.9);let i=t.getComponent(Laya.Widget);null!=i&&null!=i||(i=t.addComponent(Laya.Widget)),i.left=250,i.bottom=230,t.once(Laya.Event.COMPLETE,this,()=>{this.CreateCar(n,a),t.play(0,!0,"idle")}),t.interval=100,t.play(0,!1,"run")}CreateCar(e,n){let a=new Laya.Image;this.owner.getChildByName("Canvas").addChild(a),a.skin="image/main/shopping-cart.png",a.left=e,a.bottom=n,a.zOrder=101}PlayBgMusic(){this.bgChanel=Laya.SoundManager.playMusic("audios/bg.mp3"),this.bgChanel.volume=1}onAwake(){this.Init(),Laya.stage.on(e.NextStep,this,this.OnLoadNextScene)}Init(){this.title.getComponent(i).OnInit(),e.FruitCount=Math.floor(3*Math.random()+1),e.FruitType=Math.floor(6*Math.random()),this.InitOrder(e.FruitType,e.FruitCount)}InitOrder(e,n){this.order.getComponent(t).OnInit(e,n)}OnLoadNextScene(){e.counter<e.MaxCount?Laya.Scene.open(e.MainScene):Laya.Scene.open(e.OverScene)}}class o extends Laya.Script{constructor(){super(),this.tryBtn=null,console.log("Over 构造函数")}onAwake(){null!=this.tryBtn&&null!=this.tryBtn&&(console.log("发起订阅事件"),this.tryBtn.on(Laya.Event.CLICK,this,this.OnTryClick))}onDisable(){null!=this.tryBtn&&null!=this.tryBtn&&this.tryBtn.offAll()}OnTryClick(){e.counter=0,Laya.Scene.open(e.HomeScene)}}class l{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("scripts/HomeMgr.ts",a),e("scripts/OrderUI.ts",t),e("scripts/TitleMgr.ts",i),e("scripts/ImageDrag.ts",s),e("scripts/MainMgr.ts",r),e("scripts/OverMgr.ts",o)}}l.width=1024,l.height=768,l.scaleMode="fixedheight",l.screenMode="horizontal",l.alignV="middle",l.alignH="center",l.startScene="home.scene",l.sceneRoot="",l.debug=!1,l.stat=!1,l.physicsDebug=!1,l.exportSceneToJson=!0,l.init();new class{constructor(){window.Laya3D?Laya3D.init(l.width,l.height):Laya.init(l.width,l.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=l.scaleMode,Laya.stage.screenMode=l.screenMode,Laya.stage.alignV=l.alignV,Laya.stage.alignH=l.alignH,Laya.URL.exportSceneToJson=l.exportSceneToJson,(l.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),l.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),l.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){l.startScene&&Laya.Scene.open(l.startScene)}}}();