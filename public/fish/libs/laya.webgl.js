!function(t,e,i){i.un,i.uns;var r=i.static,n=i.class,a=i.getset,s=(i.__newvec,laya.maths.Bezier),o=laya.resource.Bitmap,h=laya.utils.Browser,u=(laya.filters.ColorFilter,laya.utils.ColorUtils),l=i.Config,c=laya.resource.Context,_=(laya.display.cmd.DrawImageCmd,laya.events.Event,laya.display.cmd.FillTextCmd,laya.filters.Filter),f=laya.utils.FontInfo,d=laya.resource.HTMLCanvas,x=(laya.utils.HTMLChar,laya.resource.HTMLImage),p=(laya.utils.Handler,laya.net.Loader,laya.maths.Matrix),b=laya.maths.Point,T=laya.maths.Rectangle,m=laya.renders.Render,v=laya.renders.RenderSprite,g=laya.resource.Resource,C=(laya.display.cmd.RestoreCmd,laya.display.cmd.RotateCmd,laya.utils.RunDriver),S=(laya.display.cmd.SaveCmd,laya.display.cmd.ScaleCmd,laya.display.Sprite),y=(laya.display.SpriteConst,laya.display.css.SpriteStyle,laya.display.Stage),R=laya.utils.Stat,E=laya.utils.StringKey,A=laya.system.System,L=(laya.display.Text,laya.resource.Texture),M=(laya.display.cmd.TransformCmd,laya.display.cmd.TranslateCmd,laya.utils.VectorGraphManager);laya.utils.WordText;i.interface("laya.webgl.submit.ISubmit"),i.interface("laya.webgl.canvas.save.ISaveData");var D=function(){function SaveBase(){}n(SaveBase,"laya.webgl.canvas.save.SaveBase");var t=SaveBase.prototype;return i.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,SaveBase.POOL[SaveBase.POOL._length++]=this,this._newSubmit&&(t._curSubmit=U.RENDERBASE)},SaveBase._createArray=function(){var t=[];return t._length=0,t},SaveBase._init=function(){var t=SaveBase._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},SaveBase.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var n=SaveBase.POOL,a=n._length>0?n[--n._length]:new SaveBase;a._value=i[a._valueName=SaveBase._namemap[e]],a._dataObj=i,a._newSubmit=r;var s=t._save;s[s._length++]=a}},SaveBase.POOL=laya.webgl.canvas.save.SaveBase._createArray(),SaveBase._namemap=SaveBase._init(),SaveBase}(),w=function(){function Value2D(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.clipOff=[0,0],this.defines=new Mt,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=Value2D._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=Value2D._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}n(Value2D,"laya.webgl.shader.d2.value.Value2D");var t=Value2D.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return Wt.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Nt.create,this._attribLocation)},t.upload=function(){var t=W;W.worldMatrix4===W.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4,W.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=W.matWVP.elements);var e=Wt.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t,t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+($.shaderHighPrecision?1024:0),this.clipOff[0]=0},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)},Value2D._initone=function(t,e){Value2D._typeClass[t]=e,Value2D._cache[t]=[],Value2D._cache[t]._length=0},Value2D.__init__=function(){Value2D._initone(4,bt),Value2D._initone(512,Tt),Value2D._initone(1,mt),Value2D._initone(9,mt)},Value2D.create=function(t,e){var i=Value2D._cache[t|e];return i._length?i[--i._length]:new Value2D._typeClass[t|e](e)},Value2D._cache=[],Value2D._typeClass=[],Value2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Value2D}(),B=function(){function SaveTranslate(){this._mat=new p}n(SaveTranslate,"laya.webgl.canvas.save.SaveTranslate");var t=SaveTranslate.prototype;return i.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),SaveTranslate.POOL[SaveTranslate.POOL._length++]=this},SaveTranslate.save=function(t){var e=SaveTranslate.POOL,i=e._length>0?e[--e._length]:new SaveTranslate;t._curMat.copyTo(i._mat);var r=t._save;r[r._length++]=i},SaveTranslate.POOL=D._createArray(),SaveTranslate}(),G=function(){function WebGLRTMgr(){}return n(WebGLRTMgr,"laya.webgl.resource.WebGLRTMgr"),WebGLRTMgr.getRT=function(t,e){e|=0,(t|=0)>=1e4&&console.error("getRT error! w too big");var i,r=1e4*e+t,n=WebGLRTMgr.dict[r];return n&&n.length>0?((i=n.pop())._mgrKey=r,i):((i=new Ot(t,e,1,-1))._mgrKey=r,i)},WebGLRTMgr.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=WebGLRTMgr.dict[t._mgrKey];!e&&(e=[],WebGLRTMgr.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},WebGLRTMgr.dict={},WebGLRTMgr}(),I=function(){function Mesh2D(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new Bt(t,35048),e?this._vb._resizeBuffer(e,!1):l.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new Gt,i&&this._ib._resizeBuffer(i,!1)}n(Mesh2D,"laya.webgl.utils.Mesh2D");var t=Mesh2D.prototype;return t.cloneWithNewVB=function(){var t=new Mesh2D(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new Mesh2D(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,n=0;n<t;n++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Et),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,r=0;r<e;r++){var n=this._attribInfo[i+1],a=this._attribInfo[i],s=this._attribInfo[i+2];t.enableVertexAttribArray(r),t.vertexAttribPointer(r,n,a,!1,this._stride,s),i+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},Mesh2D._gvaoid=0,Mesh2D}(),W=function(){function RenderState2D(){}return n(RenderState2D,"laya.webgl.utils.RenderState2D"),RenderState2D.mat2MatArray=function(t,e){var i=t,r=e;return r[0]=i.a,r[1]=i.b,r[2]=RenderState2D.EMPTYMAT4_ARRAY[2],r[3]=RenderState2D.EMPTYMAT4_ARRAY[3],r[4]=i.c,r[5]=i.d,r[6]=RenderState2D.EMPTYMAT4_ARRAY[6],r[7]=RenderState2D.EMPTYMAT4_ARRAY[7],r[8]=RenderState2D.EMPTYMAT4_ARRAY[8],r[9]=RenderState2D.EMPTYMAT4_ARRAY[9],r[10]=RenderState2D.EMPTYMAT4_ARRAY[10],r[11]=RenderState2D.EMPTYMAT4_ARRAY[11],r[12]=i.tx,r[13]=i.ty,r[14]=RenderState2D.EMPTYMAT4_ARRAY[14],r[15]=RenderState2D.EMPTYMAT4_ARRAY[15],e},RenderState2D.restoreTempArray=function(){RenderState2D.TEMPMAT4_ARRAY[0]=1,RenderState2D.TEMPMAT4_ARRAY[1]=0,RenderState2D.TEMPMAT4_ARRAY[4]=0,RenderState2D.TEMPMAT4_ARRAY[5]=1,RenderState2D.TEMPMAT4_ARRAY[12]=0,RenderState2D.TEMPMAT4_ARRAY[13]=0},RenderState2D.clear=function(){RenderState2D.worldScissorTest=!1,RenderState2D.worldAlpha=1},RenderState2D._MAXSIZE=99999999,RenderState2D.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.matWVP=null,RenderState2D.worldAlpha=1,RenderState2D.worldScissorTest=!1,RenderState2D.worldShaderDefines=null,RenderState2D.worldFilters=null,RenderState2D.width=0,RenderState2D.height=0,r(RenderState2D,["worldMatrix",function(){return this.worldMatrix=new p}]),RenderState2D}(),P=function(){function DrawStyle(t){this._color=null,this.setValue(t)}n(DrawStyle,"laya.webgl.canvas.DrawStyle");var t=DrawStyle.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:u.create(t):u.create("#000000")},t.reset=function(){this._color=u.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},DrawStyle.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:u.create(t);return e._drawStyle||(e._drawStyle=new DrawStyle(t))}return DrawStyle.DEFAULT},r(DrawStyle,["DEFAULT",function(){return this.DEFAULT=new DrawStyle("#000000")}]),DrawStyle}(),O=function(){function Shader2D(){this.ALPHA=1,this.shaderType=0,this.defines=new Mt,this.fillStyle=P.DEFAULT,this.strokeStyle=P.DEFAULT}return n(Shader2D,"laya.webgl.shader.d2.Shader2D"),Shader2D.prototype.destroy=function(){this.defines=null,this.filters=null},Shader2D.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",Wt.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",Wt.preCompile2D(0,4,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Wt.preCompile2D(0,512,t,e,null)},Shader2D}(),N=function(){function CommandEncoder(t,e,i,r){this._idata=[]}n(CommandEncoder,"laya.layagl.CommandEncoder");var t=CommandEncoder.prototype;return t.getArrayData=function(){return this._idata},t.getPtrID=function(){return 0},t.beginEncoding=function(){},t.endEncoding=function(){},t.clearEncoding=function(){this._idata.length=0},t.getCount=function(){return this._idata.length},t.add_ShaderValue=function(t){this._idata.push(t)},t.addShaderUniform=function(t){this.add_ShaderValue(t)},CommandEncoder}(),F=function(){function SkinMeshBuffer(){this.ib=null,this.vb=null;$.mainContext;this.ib=Gt.create(35048),this.vb=Bt.create(8)}n(SkinMeshBuffer,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var t=SkinMeshBuffer.prototype;return t.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},t.reset=function(){this.vb.clear(),this.ib.clear()},SkinMeshBuffer.getInstance=function(){return SkinMeshBuffer.instance=SkinMeshBuffer.instance||new SkinMeshBuffer},SkinMeshBuffer.instance=null,SkinMeshBuffer}(),V=function(){function ShaderNode(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}n(ShaderNode,"laya.webgl.utils.ShaderNode");var t=ShaderNode.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++ShaderNode.__id)},t._toscript=function(t,e,i){if(this.childs.length<1&&!this.text)return e;e.length;if(this.condition){var r=!!this.condition.call(t);if(2===this.conditionType&&(r=!r),!r)return e}if(this.text&&e.push(this.text),this.childs.length>0&&this.childs.forEach(function(r,n,a){r._toscript(t,e,i)}),this.includefiles.length>0&&this.useFuns.length>0)for(var n,a=0,s=this.includefiles.length;a<s;a++)this.includefiles[a].curUseID!=i&&(n=this.includefiles[a].file.getFunsScript(this.useFuns)).length>0&&(this.includefiles[a].curUseID=i,e[0]=n+e[0]);return e},ShaderNode.__id=1,ShaderNode}(),U=function(){function Submit(t){this.clipInfoID=-1,this._mesh=null,this._blendFn=null,this._id=0,this._renderType=0,this._parent=null,this._startIdx=0,this._numEle=0,this._ref=1,this.shaderValue=null,this._key=new ht,void 0===t&&(t=1e4),this._renderType=t,this._id=++Submit.ID}n(Submit,"laya.webgl.submit.Submit");var t=Submit.prototype;return i.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){Submit.RENDERBASE!=this&&--this._ref<1&&(Submit.POOL[Submit._poolSize++]=this,this.shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=$.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),q.activeBlendFunction!==this._blendFn&&(j.setBlend(i,!0),this._blendFn(i),q.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),R.renderBatches++,R.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,i,r){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=r*dt.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,i){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},Submit.__init__=function(){var t=Submit.RENDERBASE=new Submit(-1);t.shaderValue=new w(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},Submit.create=function(t,e,i){var r=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;r._ref=1,r._mesh=e,r._key.clear(),r._startIdx=e.indexNum*dt.BYTES_PIDX,r._numEle=0;var n=t._nBlendType;r._blendFn=t._targets?q.targetFns[n]:q.fns[n],r.shaderValue=i,r.shaderValue.setValue(t._shader2D);var a=t._shader2D.filters;return a&&r.shaderValue.setFilters(a),r},Submit.createShape=function(t,e,i,r){var n=Submit._poolSize?Submit.POOL[--Submit._poolSize]:new Submit;n._mesh=e,n._numEle=i,n._startIdx=2*e.indexNum,n._ref=1,n.shaderValue=r,n.shaderValue.setValue(t._shader2D);var a=t._nBlendType;return n._key.blendShader=a,n._blendFn=t._targets?q.targetFns[a]:q.fns[a],n},Submit.TYPE_2D=1e4,Submit.TYPE_CANVAS=10003,Submit.TYPE_CMDSETRT=10004,Submit.TYPE_CUSTOM=10005,Submit.TYPE_BLURRT=10006,Submit.TYPE_CMDDESTORYPRERT=10007,Submit.TYPE_DISABLESTENCIL=10008,Submit.TYPE_OTHERIBVB=10009,Submit.TYPE_PRIMITIVE=10010,Submit.TYPE_RT=10011,Submit.TYPE_BLUR_RT=10012,Submit.TYPE_TARGET=10013,Submit.TYPE_CHANGE_VALUE=10014,Submit.TYPE_SHAPE=10015,Submit.TYPE_TEXTURE=10016,Submit.TYPE_FILLTEXTURE=10017,Submit.KEY_ONCE=-1,Submit.KEY_FILLRECT=1,Submit.KEY_DRAWTEXTURE=2,Submit.KEY_VG=3,Submit.KEY_TRIANGLES=4,Submit.RENDERBASE=null,Submit.ID=1,Submit.preRender=null,Submit._poolSize=0,Submit.POOL=[],Submit}(),k=function(){function SaveTransform(){this._matrix=new p}n(SaveTransform,"laya.webgl.canvas.save.SaveTransform");var t=SaveTransform.prototype;return i.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,SaveTransform.POOL[SaveTransform.POOL._length++]=this},SaveTransform.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=SaveTransform.POOL,r=i._length>0?i[--i._length]:new SaveTransform;r._savematrix=t._curMat,t._curMat=t._curMat.copyTo(r._matrix);var n=t._save;n[n._length++]=r}},SaveTransform.POOL=D._createArray(),SaveTransform}(),X=function(){function BasePoly(){}return n(BasePoly,"laya.webgl.shapes.BasePoly"),BasePoly.createLine2=function(t,e,i,r,n,a){if(t.length<4)return null;var s=BasePoly.tempData.length>t.length+2?BasePoly.tempData:new Array(t.length+2);s[0]=t[0],s[1]=t[1];var o=2,h=0,u=t.length;for(h=2;h<u;h+=2)Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])>.01&&(s[o++]=t[h],s[o++]=t[h+1]);a&&Math.abs(t[0]-s[o-2])+Math.abs(t[1]-s[o-1])>.01&&(s[o++]=t[0],s[o++]=t[1]);var l=n;u=o/2;var c,_,f,d,x,p,b,T,m,v,g,C,S,y,R,E,A,L,M,D,w=i/2;f=s[0],d=s[1],v=f-(x=s[2]);m=(m=-(d-(p=s[3])))/(D=Math.sqrt(m*m+v*v))*w,v=v/D*w;for(l.push(f-m,d-v,f+m,d+v),h=1;h<u-1;h++)f=s[2*(h-1)],d=s[2*(h-1)+1],x=s[2*h],p=s[2*h+1],b=s[2*(h+1)],T=s[2*(h+1)+1],v=f-x,C=x-b,R=(-(m=(m=-(d-p))/(D=Math.sqrt(m*m+v*v))*w)+f)*(-(v=v/D*w)+p)-(-m+x)*(-v+d),L=(-(g=(g=-(p-T))/(D=Math.sqrt(g*g+C*C))*w)+b)*(-(C=C/D*w)+p)-(-g+x)*(-C+T),M=(S=-v+d-(-v+p))*(A=-g+x-(-g+b))-(E=-C+T-(-C+p))*(y=-m+x-(-m+f)),Math.abs(M)<.1?(M+=10.1,l.push(x-m,p-v,x+m,p+v)):(((c=(y*L-A*R)/M)-x)*(c-x)+((_=(E*R-S*L)/M)-p)+(_-p),l.push(c,_,x-(c-x),p-(_-p)));for(f=s[o-4],d=s[o-3],v=f-(x=s[o-2]),m=(m=-(d-(p=s[o-1])))/(D=Math.sqrt(m*m+v*v))*w,v=v/D*w,l.push(x-m,p-v,x+m,p+v),h=1;h<u;h++)e.push(r+2*(h-1),r+2*(h-1)+1,r+2*h+1,r+2*h+1,r+2*h,r+2*(h-1));return l},BasePoly.createLineTriangle=function(t,e,i,r,n,a,s){var o=t.slice(),h=o.length,u=o[0],l=o[1],c=o[2],_=(o[2],0),f=0,d=0,x=0,p=h/2;if(!(p<=1)&&2!=p){for(var b=new Array(4*p),T=0,m=0,v=0;v<p-1;v++)u=o[m++],l=o[m++],c=o[m++],x=o[m++]-l,0!=(d=c-u)&&0!=x&&(_=Math.sqrt(d*d+x*x))>.001&&(b[f=4*T]=u,b[f+1]=l,b[f+2]=d/_,b[f+3]=x/_,T++);for(r?(u=o[h-2],l=o[h-1],c=o[0],x=o[1]-l,0!=(d=c-u)&&0!=x&&(_=Math.sqrt(d*d+x*x))>.001&&(b[f=4*T]=u,b[f+1]=l,b[f+2]=d/_,b[f+3]=x/_,T++)):(b[f=4*T]=u,b[f+1]=l,b[f+2]=d/_,b[f+3]=x/_,T++),m=0,v=0;v<p;v++){u=o[m],l=o[m+1],c=o[m+2],o[m+3];o[m+4],o[m+5]}}},r(BasePoly,["tempData",function(){return this.tempData=new Array(256)}]),BasePoly}(),H=function(){function SaveClipRect(){this._clipInfoID=-1,this._globalClipMatrix=new p,this._clipRect=new T}n(SaveClipRect,"laya.webgl.canvas.save.SaveClipRect");var t=SaveClipRect.prototype;return i.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,SaveClipRect.POOL[SaveClipRect.POOL._length++]=this},SaveClipRect.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=SaveClipRect.POOL,i=e._length>0?e[--e._length]:new SaveClipRect;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID;var r=t._save;r[r._length++]=i}},SaveClipRect.POOL=D._createArray(),SaveClipRect}(),z=function(){function ICharRender(){}n(ICharRender,"laya.webgl.resource.ICharRender");var t=ICharRender.prototype;return t.getWidth=function(t,e){return 0},t.scale=function(t,e){},t.getCharBmp=function(t,e,i,r,n,a,s,o,h,u,l){return null},a(0,t,"canvasWidth",function(){return 0},function(t){}),ICharRender}(),Y=function(){function CharSubmitCache(){this._data=[],this._ndata=0,this._tex=null,this._imgId=0,this._clipid=-1,this._enbale=!1,this._colorFiler=null,this._clipMatrix=new p}n(CharSubmitCache,"laya.webgl.text.CharSubmitCache");var t=CharSubmitCache.prototype;return t.clear=function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null},t.destroy=function(){this.clear(),this._data.length=0,this._data=null},t.add=function(t,e,i,r,n,a){this._ndata>0&&(this._tex!=e||this._imgId!=i||this._clipid>=0&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=r,this._data[this._ndata+1]=n,this._data[this._ndata+2]=a,this._ndata+=3},t.getPos=function(){return 0==CharSubmitCache.__nPosPool?new Array(8):CharSubmitCache.__posPool[--CharSubmitCache.__nPosPool]},t.enable=function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))},t.submit=function(t){var e=this._ndata;if(e){var i=t._mesh,r=t._colorFiler;t._colorFiler=this._colorFiler;var n=Ct.create(t,i,w.create(1,0));t._submits[t._submits._length++]=t._curSubmit=n,n.shaderValue.textureHost=this._tex,n._key.other=this._imgId,t._colorFiler=r,t._copyClipInfo(n,this._clipMatrix),n.clipInfoID=this._clipid;for(var a=0;a<e;a+=3)i.addQuad(this._data[a],this._data[a+1],this._data[a+2],!0),CharSubmitCache.__posPool[CharSubmitCache.__nPosPool++]=this._data[a];e/=3,n._numEle+=6*e,i.indexNum+=6*e,i.vertNum+=4*e,t._drawCount+=e,this._ndata=0,R.loopCount%100==0&&(this._data.length=0)}},CharSubmitCache.__posPool=[],CharSubmitCache.__nPosPool=0,CharSubmitCache}(),Q=function(){function BufferStateBase(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=lt.instance.createVertexArray()}n(BufferStateBase,"laya.webgl.BufferStateBase");var t=BufferStateBase.prototype;return t.bind=function(){BufferStateBase._curBindedBufferState!==this&&(lt.instance.bindVertexArray(this._nativeVertexArrayObject),BufferStateBase._curBindedBufferState=this)},t.unBind=function(){if(BufferStateBase._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";lt.instance.bindVertexArray(null),BufferStateBase._curBindedBufferState=null},t.bindForNative=function(){lt.instance.bindVertexArray(this._nativeVertexArrayObject),BufferStateBase._curBindedBufferState=this},t.unBindForNative=function(){lt.instance.bindVertexArray(null),BufferStateBase._curBindedBufferState=null},t.destroy=function(){lt.instance.deleteVertexArray(this._nativeVertexArrayObject)},BufferStateBase._curBindedBufferState=null,BufferStateBase}(),j=(function(){function QuickTestTool(){this._renderType=0,this._repaint=0,this._x=NaN,this._y=NaN}n(QuickTestTool,"laya.layagl.QuickTestTool");var t=QuickTestTool.prototype;t.render=function(t,e,i){QuickTestTool._addType(this._renderType),QuickTestTool.showRenderTypeInfo(this._renderType),v.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t._stageRender=function(t,e,r){QuickTestTool._countStart(),QuickTestTool._PreStageRender.call(i.stage,t,e,r),QuickTestTool._countEnd()},QuickTestTool.getMCDName=function(t){return QuickTestTool._typeToNameDic[t]},QuickTestTool.showRenderTypeInfo=function(t,e){if(void 0===e&&(e=!1),e||!QuickTestTool.showedDic[t]){if(QuickTestTool.showedDic[t]=!0,!QuickTestTool._rendertypeToStrDic[t]){var i=[],r=0;for(r=1;r<=t;)r&t&&i.push(QuickTestTool.getMCDName(r&t)),r<<=1;QuickTestTool._rendertypeToStrDic[t]=i.join(",")}console.log("cmd:",QuickTestTool._rendertypeToStrDic[t])}},QuickTestTool.__init__=function(){QuickTestTool._typeToNameDic[1]="ALPHA",QuickTestTool._typeToNameDic[2]="TRANSFORM",QuickTestTool._typeToNameDic[256]="TEXTURE",QuickTestTool._typeToNameDic[512]="GRAPHICS",QuickTestTool._typeToNameDic[4096]="ONECHILD",QuickTestTool._typeToNameDic[8192]="CHILDS",QuickTestTool._typeToNameDic[3]="TRANSFORM|ALPHA",QuickTestTool._typeToNameDic[8]="CANVAS",QuickTestTool._typeToNameDic[4]="BLEND",QuickTestTool._typeToNameDic[16]="FILTERS",QuickTestTool._typeToNameDic[32]="MASK",QuickTestTool._typeToNameDic[64]="CLIP",QuickTestTool._typeToNameDic[1024]="LAYAGL3D"},QuickTestTool._countStart=function(){var t;for(t in QuickTestTool._countDic)QuickTestTool._countDic[t]=0},QuickTestTool._countEnd=function(){QuickTestTool._i++,QuickTestTool._i>60&&(QuickTestTool.showCountInfo(),QuickTestTool._i=0)},QuickTestTool._addType=function(t){QuickTestTool._countDic[t]?QuickTestTool._countDic[t]+=1:QuickTestTool._countDic[t]=1},QuickTestTool.showCountInfo=function(){var t;for(t in console.log("==================="),QuickTestTool._countDic)console.log("count:"+QuickTestTool._countDic[t]),QuickTestTool.showRenderTypeInfo(t,!0)},QuickTestTool.enableQuickTest=function(){QuickTestTool.__init__(),S.prototype.render=QuickTestTool.prototype.render,QuickTestTool._PreStageRender=y.prototype.render,y.prototype.render=QuickTestTool.prototype._stageRender},QuickTestTool.showedDic={},QuickTestTool._rendertypeToStrDic={},QuickTestTool._typeToNameDic={},QuickTestTool._PreStageRender=null,QuickTestTool._countDic={},QuickTestTool._i=0}(),function(){function ArabicReshaper(){}n(ArabicReshaper,"laya.webgl.text.ArabicReshaper");var t=ArabicReshaper.prototype;t.characterMapContains=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return!0;return!1},t.getCharRep=function(t){for(var e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e][0]===t)return ArabicReshaper.charsMap[e];return!1},t.getCombCharRep=function(t,e){for(var i=0;i<ArabicReshaper.combCharsMap.length;++i)if(ArabicReshaper.combCharsMap[i][0][0]===t&&ArabicReshaper.combCharsMap[i][0][1]===e)return ArabicReshaper.combCharsMap[i];return!1},t.isTransparent=function(t){for(var e=0;e<ArabicReshaper.transChars.length;++e)if(ArabicReshaper.transChars[e]===t)return!0;return!1},t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<ArabicReshaper.charsMap.length;++e)if(ArabicReshaper.charsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.charsMap[e][0]);for(e=0;e<ArabicReshaper.combCharsMap.length;++e)if(ArabicReshaper.combCharsMap[e].indexOf(t)>-1)return String.fromCharCode(ArabicReshaper.combCharsMap[e][0][0])+String.fromCharCode(ArabicReshaper.combCharsMap[e][0][1]);return String.fromCharCode(t)},t.convertArabic=function(t){for(var e,i,r="",n=0;n<t.length;++n){var a=t.charCodeAt(n);if(this.characterMapContains(a)){for(var s=null,o=null,h=n-1,u=n+1;h>=0&&this.isTransparent(t.charCodeAt(h));--h);for((!(e=!!(s=h>=0?t.charCodeAt(h):null)&&this.getCharRep(s))||null==e[2]&&null==e[3])&&(s=null);u<t.length&&this.isTransparent(t.charCodeAt(u));++u);if((!(e=!!(o=u<t.length?t.charCodeAt(u):null)&&this.getCharRep(o))||null==e[3]&&null==e[4])&&(o=null),1604===a&&null!=o&&(1570===o||1571===o||1573===o||1575===o)){i=this.getCombCharRep(a,o),r+=null!=s?String.fromCharCode(i[4]):String.fromCharCode(i[1]),++n;continue}if(e=this.getCharRep(a),null!=s&&null!=o&&null!=e[3]){r+=String.fromCharCode(e[3]);continue}if(null!=s&&null!=e[4]){r+=String.fromCharCode(e[4]);continue}if(null!=o&&null!=e[2]){r+=String.fromCharCode(e[2]);continue}r+=String.fromCharCode(e[1])}else r+=String.fromCharCode(a)}return r},t.convertArabicBack=function(t){var e="",i=0,r=0;for(r=0;r<t.length;++r)i=t.charCodeAt(r),e+=this.getOriginalCharsFromCode(i);return e},r(ArabicReshaper,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}])}(),function(){function WebGLContext(){}n(WebGLContext,"laya.webgl.WebGLContext");var e=WebGLContext.prototype;return e.getContextAttributes=function(){return null},e.isContextLost=function(){},e.getSupportedExtensions=function(){return null},e.getExtension=function(t){return null},e.activeTexture=function(t){},e.attachShader=function(t,e){},e.bindAttribLocation=function(t,e,i){},e.bindBuffer=function(t,e){},e.bindFramebuffer=function(t,e){},e.bindRenderbuffer=function(t,e){},e.bindTexture=function(t,e){},e.useTexture=function(t){},e.blendColor=function(t,e,i,r){},e.blendEquation=function(t){},e.blendEquationSeparate=function(t,e){},e.blendFunc=function(t,e){},e.blendFuncSeparate=function(t,e,i,r){},e.bufferData=function(t,e,i){},e.bufferSubData=function(t,e,i){},e.checkFramebufferStatus=function(t){return null},e.clear=function(t){},e.clearColor=function(t,e,i,r){},e.clearDepth=function(t){},e.clearStencil=function(t){},e.colorMask=function(t,e,i,r){},e.compileShader=function(t){},e.copyTexImage2D=function(t,e,i,r,n,a,s,o){},e.copyTexSubImage2D=function(t,e,i,r,n,a,s,o){},e.createBuffer=function(){},e.createFramebuffer=function(){},e.createProgram=function(){},e.createRenderbuffer=function(){},e.createShader=function(t){},e.createTexture=function(){return null},e.cullFace=function(t){},e.deleteBuffer=function(t){},e.deleteFramebuffer=function(t){},e.deleteProgram=function(t){},e.deleteRenderbuffer=function(t){},e.deleteShader=function(t){},e.deleteTexture=function(t){},e.depthFunc=function(t){},e.depthMask=function(t){},e.depthRange=function(t,e){},e.detachShader=function(t,e){},e.disable=function(t){},e.disableVertexAttribArray=function(t){},e.drawArrays=function(t,e,i){},e.drawElements=function(t,e,i,r){},e.enable=function(t){},e.enableVertexAttribArray=function(t){},e.finish=function(){},e.flush=function(){},e.framebufferRenderbuffer=function(t,e,i,r){},e.framebufferTexture2D=function(t,e,i,r,n){},e.frontFace=function(t){return null},e.generateMipmap=function(t){return null},e.getActiveAttrib=function(t,e){return null},e.getActiveUniform=function(t,e){return null},e.getAttribLocation=function(t,e){return 0},e.getParameter=function(t){return null},e.getBufferParameter=function(t,e){return null},e.getError=function(){return null},e.getFramebufferAttachmentParameter=function(t,e,i){},e.getProgramParameter=function(t,e){return 0},e.getProgramInfoLog=function(t){return null},e.getRenderbufferParameter=function(t,e){return null},e.getShaderPrecisionFormat=function(t){return null},e.getShaderParameter=function(t,e){},e.getShaderInfoLog=function(t){return null},e.getShaderSource=function(t){return null},e.getTexParameter=function(t,e){},e.getUniform=function(t,e){},e.getUniformLocation=function(t,e){return null},e.getVertexAttrib=function(t,e){return null},e.getVertexAttribOffset=function(t,e){return null},e.hint=function(t,e){},e.isBuffer=function(t){},e.isEnabled=function(t){},e.isFramebuffer=function(t){},e.isProgram=function(t){},e.isRenderbuffer=function(t){},e.isShader=function(t){},e.isTexture=function(t){},e.lineWidth=function(t){},e.linkProgram=function(t){},e.pixelStorei=function(t,e){},e.polygonOffset=function(t,e){},e.readPixels=function(t,e,i,r,n,a,s){},e.renderbufferStorage=function(t,e,i,r){},e.sampleCoverage=function(t,e){},e.scissor=function(t,e,i,r){},e.shaderSource=function(t,e){},e.stencilFunc=function(t,e,i){},e.stencilFuncSeparate=function(t,e,i,r){},e.stencilMask=function(t){},e.stencilMaskSeparate=function(t,e){},e.stencilOp=function(t,e,i){},e.stencilOpSeparate=function(t,e,i,r){},e.texImage2D=function(t){},e.texParameterf=function(t,e,i){},e.texParameteri=function(t,e,i){},e.texSubImage2D=function(t){},e.uniform1f=function(t,e){},e.uniform1fv=function(t,e){},e.uniform1i=function(t,e){},e.uniform1iv=function(t,e){},e.uniform2f=function(t,e,i){},e.uniform2fv=function(t,e){},e.uniform2i=function(t,e,i){},e.uniform2iv=function(t,e){},e.uniform3f=function(t,e,i,r){},e.uniform3fv=function(t,e){},e.uniform3i=function(t,e,i,r){},e.uniform3iv=function(t,e){},e.uniform4f=function(t,e,i,r,n){},e.uniform4fv=function(t,e){},e.uniform4i=function(t,e,i,r,n){},e.uniform4iv=function(t,e){},e.uniformMatrix2fv=function(t,e,i){},e.uniformMatrix3fv=function(t,e,i){},e.uniformMatrix4fv=function(t,e,i){},e.useProgram=function(t){},e.validateProgram=function(t){},e.vertexAttrib1f=function(t,e){},e.vertexAttrib1fv=function(t,e){},e.vertexAttrib2f=function(t,e,i){},e.vertexAttrib2fv=function(t,e){},e.vertexAttrib3f=function(t,e,i,r){},e.vertexAttrib3fv=function(t,e){},e.vertexAttrib4f=function(t,e,i,r,n){},e.vertexAttrib4fv=function(t,e){},e.vertexAttribPointer=function(t,e,i,r,n,a){},e.viewport=function(t,e,i,r){},e.configureBackBuffer=function(t,e,i,r,n){void 0===r&&(r=!0),void 0===n&&(n=!1)},e.compressedTexImage2D=function(t){},e.createVertexArray=function(){throw"not implemented"},e.bindVertexArray=function(t){throw"not implemented"},e.deleteVertexArray=function(t){throw"not implemented"},e.isVertexArray=function(t){throw"not implemented"},WebGLContext.__init__=function(e){if(laya.webgl.WebGLContext._checkExtensions(e),!$._isWebGL2&&!m.isConchApp){t._setupVertexArrayObject&&(h.onMiniGame&&h.onIOS||h.onBDMiniGame||h.onLimixiu?t._forceSetupVertexArrayObject(e):t._setupVertexArrayObject(e));var i=(e.rawgl||e).getExtension("OES_vertex_array_object");if(i){console.log("EXT:webgl support OES_vertex_array_object！");var r=e;r.createVertexArray=function(){return i.createVertexArrayOES()},r.bindVertexArray=function(t){i.bindVertexArrayOES(t)},r.deleteVertexArray=function(t){i.deleteVertexArrayOES(t)},r.isVertexArray=function(t){i.isVertexArrayOES(t)}}}},WebGLContext._getExtension=function(t,e){var i=WebGLContext._extentionVendorPrefixes;for(var r in i){var n=t.getExtension(i[r]+e);if(n)return n}return null},WebGLContext._checkExtensions=function(t){WebGLContext._extTextureFilterAnisotropic=WebGLContext._getExtension(t,"EXT_texture_filter_anisotropic"),WebGLContext._compressedTextureS3tc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_s3tc"),WebGLContext._compressedTexturePvrtc=WebGLContext._getExtension(t,"WEBGL_compressed_texture_pvrtc"),WebGLContext._compressedTextureEtc1=WebGLContext._getExtension(t,"WEBGL_compressed_texture_etc1"),WebGLContext._angleInstancedArrays=WebGLContext._getExtension(t,"ANGLE_instanced_arrays")},WebGLContext.__init_native=function(){if(m.supportWebGLPlusRendering){var t=WebGLContext;t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative}},WebGLContext.useProgram=function(t,e){return WebGLContext._useProgram!==e&&(t.useProgram(e),WebGLContext._useProgram=e,!0)},WebGLContext.setDepthTest=function(t,e){e!==WebGLContext._depthTest&&(WebGLContext._depthTest=e,e?t.enable(2929):t.disable(2929))},WebGLContext.setDepthMask=function(t,e){e!==WebGLContext._depthMask&&(WebGLContext._depthMask=e,t.depthMask(e))},WebGLContext.setDepthFunc=function(t,e){e!==WebGLContext._depthFunc&&(WebGLContext._depthFunc=e,t.depthFunc(e))},WebGLContext.setBlend=function(t,e){e!==WebGLContext._blend&&(WebGLContext._blend=e,e?t.enable(3042):t.disable(3042))},WebGLContext.setBlendFunc=function(t,e,i){(e!==WebGLContext._sFactor||i!==WebGLContext._dFactor)&&(WebGLContext._sFactor=WebGLContext._srcAlpha=e,WebGLContext._dFactor=WebGLContext._dstAlpha=i,t.blendFunc(e,i))},WebGLContext.setBlendFuncSeperate=function(t,e,i,r,n){e===WebGLContext._sFactor&&i===WebGLContext._dFactor&&r===WebGLContext._srcAlpha&&n===WebGLContext._dstAlpha||(WebGLContext._sFactor=e,WebGLContext._dFactor=i,WebGLContext._srcAlpha=r,WebGLContext._dstAlpha=n,t.blendFuncSeparate(e,i,r,n))},WebGLContext.setCullFace=function(t,e){e!==WebGLContext._cullFace&&(WebGLContext._cullFace=e,e?t.enable(2884):t.disable(2884))},WebGLContext.setFrontFace=function(t,e){e!==WebGLContext._frontFace&&(WebGLContext._frontFace=e,t.frontFace(e))},WebGLContext.activeTexture=function(t,e){WebGLContext._activedTextureID!==e&&(t.activeTexture(e),WebGLContext._activedTextureID=e)},WebGLContext.bindTexture=function(t,e,i){WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]!==i&&(t.bindTexture(e,i),WebGLContext._activeTextures[WebGLContext._activedTextureID-33984]=i)},WebGLContext.useProgramForNative=function(t,e){return t.useProgram(e),!0},WebGLContext.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},WebGLContext.setDepthMaskForNative=function(t,e){t.depthMask(e)},WebGLContext.setDepthFuncForNative=function(t,e){t.depthFunc(e)},WebGLContext.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},WebGLContext.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},WebGLContext.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},WebGLContext.setFrontFaceForNative=function(t,e){t.frontFace(e)},WebGLContext.activeTextureForNative=function(t,e){t.activeTexture(e)},WebGLContext.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},WebGLContext.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},WebGLContext.DEPTH_BUFFER_BIT=256,WebGLContext.STENCIL_BUFFER_BIT=1024,WebGLContext.COLOR_BUFFER_BIT=16384,WebGLContext.POINTS=0,WebGLContext.LINES=1,WebGLContext.LINE_LOOP=2,WebGLContext.LINE_STRIP=3,WebGLContext.TRIANGLES=4,WebGLContext.TRIANGLE_STRIP=5,WebGLContext.TRIANGLE_FAN=6,WebGLContext.ZERO=0,WebGLContext.ONE=1,WebGLContext.SRC_COLOR=768,WebGLContext.ONE_MINUS_SRC_COLOR=769,WebGLContext.SRC_ALPHA=770,WebGLContext.ONE_MINUS_SRC_ALPHA=771,WebGLContext.DST_ALPHA=772,WebGLContext.ONE_MINUS_DST_ALPHA=773,WebGLContext.DST_COLOR=774,WebGLContext.ONE_MINUS_DST_COLOR=775,WebGLContext.SRC_ALPHA_SATURATE=776,WebGLContext.FUNC_ADD=32774,WebGLContext.BLEND_EQUATION=32777,WebGLContext.BLEND_EQUATION_RGB=32777,WebGLContext.BLEND_EQUATION_ALPHA=34877,WebGLContext.FUNC_SUBTRACT=32778,WebGLContext.FUNC_REVERSE_SUBTRACT=32779,WebGLContext.BLEND_DST_RGB=32968,WebGLContext.BLEND_SRC_RGB=32969,WebGLContext.BLEND_DST_ALPHA=32970,WebGLContext.BLEND_SRC_ALPHA=32971,WebGLContext.CONSTANT_COLOR=32769,WebGLContext.ONE_MINUS_CONSTANT_COLOR=32770,WebGLContext.CONSTANT_ALPHA=32771,WebGLContext.ONE_MINUS_CONSTANT_ALPHA=32772,WebGLContext.BLEND_COLOR=32773,WebGLContext.ARRAY_BUFFER=34962,WebGLContext.ELEMENT_ARRAY_BUFFER=34963,WebGLContext.ARRAY_BUFFER_BINDING=34964,WebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=34965,WebGLContext.STREAM_DRAW=35040,WebGLContext.STATIC_DRAW=35044,WebGLContext.DYNAMIC_DRAW=35048,WebGLContext.BUFFER_SIZE=34660,WebGLContext.BUFFER_USAGE=34661,WebGLContext.CURRENT_VERTEX_ATTRIB=34342,WebGLContext.FRONT=1028,WebGLContext.BACK=1029,WebGLContext.CULL_FACE=2884,WebGLContext.FRONT_AND_BACK=1032,WebGLContext.BLEND=3042,WebGLContext.DITHER=3024,WebGLContext.STENCIL_TEST=2960,WebGLContext.DEPTH_TEST=2929,WebGLContext.SCISSOR_TEST=3089,WebGLContext.POLYGON_OFFSET_FILL=32823,WebGLContext.SAMPLE_ALPHA_TO_COVERAGE=32926,WebGLContext.SAMPLE_COVERAGE=32928,WebGLContext.NO_ERROR=0,WebGLContext.INVALID_ENUM=1280,WebGLContext.INVALID_VALUE=1281,WebGLContext.INVALID_OPERATION=1282,WebGLContext.OUT_OF_MEMORY=1285,WebGLContext.CW=2304,WebGLContext.CCW=2305,WebGLContext.LINE_WIDTH=2849,WebGLContext.ALIASED_POINT_SIZE_RANGE=33901,WebGLContext.ALIASED_LINE_WIDTH_RANGE=33902,WebGLContext.CULL_FACE_MODE=2885,WebGLContext.FRONT_FACE=2886,WebGLContext.DEPTH_RANGE=2928,WebGLContext.DEPTH_WRITEMASK=2930,WebGLContext.DEPTH_CLEAR_VALUE=2931,WebGLContext.DEPTH_FUNC=2932,WebGLContext.STENCIL_CLEAR_VALUE=2961,WebGLContext.STENCIL_FUNC=2962,WebGLContext.STENCIL_FAIL=2964,WebGLContext.STENCIL_PASS_DEPTH_FAIL=2965,WebGLContext.STENCIL_PASS_DEPTH_PASS=2966,WebGLContext.STENCIL_REF=2967,WebGLContext.STENCIL_VALUE_MASK=2963,WebGLContext.STENCIL_WRITEMASK=2968,WebGLContext.STENCIL_BACK_FUNC=34816,WebGLContext.STENCIL_BACK_FAIL=34817,WebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=34818,WebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=34819,WebGLContext.STENCIL_BACK_REF=36003,WebGLContext.STENCIL_BACK_VALUE_MASK=36004,WebGLContext.STENCIL_BACK_WRITEMASK=36005,WebGLContext.VIEWPORT=2978,WebGLContext.SCISSOR_BOX=3088,WebGLContext.COLOR_CLEAR_VALUE=3106,WebGLContext.COLOR_WRITEMASK=3107,WebGLContext.UNPACK_ALIGNMENT=3317,WebGLContext.PACK_ALIGNMENT=3333,WebGLContext.MAX_TEXTURE_SIZE=3379,WebGLContext.MAX_VIEWPORT_DIMS=3386,WebGLContext.SUBPIXEL_BITS=3408,WebGLContext.RED_BITS=3410,WebGLContext.GREEN_BITS=3411,WebGLContext.BLUE_BITS=3412,WebGLContext.ALPHA_BITS=3413,WebGLContext.DEPTH_BITS=3414,WebGLContext.STENCIL_BITS=3415,WebGLContext.POLYGON_OFFSET_UNITS=10752,WebGLContext.POLYGON_OFFSET_FACTOR=32824,WebGLContext.TEXTURE_BINDING_2D=32873,WebGLContext.SAMPLE_BUFFERS=32936,WebGLContext.SAMPLES=32937,WebGLContext.SAMPLE_COVERAGE_VALUE=32938,WebGLContext.SAMPLE_COVERAGE_INVERT=32939,WebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=34466,WebGLContext.COMPRESSED_TEXTURE_FORMATS=34467,WebGLContext.DONT_CARE=4352,WebGLContext.FASTEST=4353,WebGLContext.NICEST=4354,WebGLContext.GENERATE_MIPMAP_HINT=33170,WebGLContext.BYTE=5120,WebGLContext.UNSIGNED_BYTE=5121,WebGLContext.SHORT=5122,WebGLContext.UNSIGNED_SHORT=5123,WebGLContext.INT=5124,WebGLContext.UNSIGNED_INT=5125,WebGLContext.FLOAT=5126,WebGLContext.DEPTH_COMPONENT=6402,WebGLContext.ALPHA=6406,WebGLContext.RGB=6407,WebGLContext.RGBA=6408,WebGLContext.LUMINANCE=6409,WebGLContext.LUMINANCE_ALPHA=6410,WebGLContext.UNSIGNED_SHORT_4_4_4_4=32819,WebGLContext.UNSIGNED_SHORT_5_5_5_1=32820,WebGLContext.UNSIGNED_SHORT_5_6_5=33635,WebGLContext.FRAGMENT_SHADER=35632,WebGLContext.VERTEX_SHADER=35633,WebGLContext.MAX_VERTEX_ATTRIBS=34921,WebGLContext.MAX_VERTEX_UNIFORM_VECTORS=36347,WebGLContext.MAX_VARYING_VECTORS=36348,WebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,WebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,WebGLContext.MAX_TEXTURE_IMAGE_UNITS=34930,WebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=36349,WebGLContext.SHADER_TYPE=35663,WebGLContext.DELETE_STATUS=35712,WebGLContext.LINK_STATUS=35714,WebGLContext.VALIDATE_STATUS=35715,WebGLContext.ATTACHED_SHADERS=35717,WebGLContext.ACTIVE_UNIFORMS=35718,WebGLContext.ACTIVE_ATTRIBUTES=35721,WebGLContext.SHADING_LANGUAGE_VERSION=35724,WebGLContext.CURRENT_PROGRAM=35725,WebGLContext.NEVER=512,WebGLContext.LESS=513,WebGLContext.EQUAL=514,WebGLContext.LEQUAL=515,WebGLContext.GREATER=516,WebGLContext.NOTEQUAL=517,WebGLContext.GEQUAL=518,WebGLContext.ALWAYS=519,WebGLContext.KEEP=7680,WebGLContext.REPLACE=7681,WebGLContext.INCR=7682,WebGLContext.DECR=7683,WebGLContext.INVERT=5386,WebGLContext.INCR_WRAP=34055,WebGLContext.DECR_WRAP=34056,WebGLContext.VENDOR=7936,WebGLContext.RENDERER=7937,WebGLContext.VERSION=7938,WebGLContext.NEAREST=9728,WebGLContext.LINEAR=9729,WebGLContext.NEAREST_MIPMAP_NEAREST=9984,WebGLContext.LINEAR_MIPMAP_NEAREST=9985,WebGLContext.NEAREST_MIPMAP_LINEAR=9986,WebGLContext.LINEAR_MIPMAP_LINEAR=9987,WebGLContext.TEXTURE_MAG_FILTER=10240,WebGLContext.TEXTURE_MIN_FILTER=10241,WebGLContext.TEXTURE_WRAP_S=10242,WebGLContext.TEXTURE_WRAP_T=10243,WebGLContext.TEXTURE_2D=3553,WebGLContext.TEXTURE_3D=32879,WebGLContext.TEXTURE=5890,WebGLContext.TEXTURE_CUBE_MAP=34067,WebGLContext.TEXTURE_BINDING_CUBE_MAP=34068,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=34069,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,WebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=34076,WebGLContext.TEXTURE0=33984,WebGLContext.TEXTURE1=33985,WebGLContext.TEXTURE2=33986,WebGLContext.TEXTURE3=33987,WebGLContext.TEXTURE4=33988,WebGLContext.TEXTURE5=33989,WebGLContext.TEXTURE6=33990,WebGLContext.TEXTURE7=33991,WebGLContext.TEXTURE8=33992,WebGLContext.TEXTURE9=33993,WebGLContext.TEXTURE10=33994,WebGLContext.TEXTURE11=33995,WebGLContext.TEXTURE12=33996,WebGLContext.TEXTURE13=33997,WebGLContext.TEXTURE14=33998,WebGLContext.TEXTURE15=33999,WebGLContext.TEXTURE16=34e3,WebGLContext.TEXTURE17=34001,WebGLContext.TEXTURE18=34002,WebGLContext.TEXTURE19=34003,WebGLContext.TEXTURE20=34004,WebGLContext.TEXTURE21=34005,WebGLContext.TEXTURE22=34006,WebGLContext.TEXTURE23=34007,WebGLContext.TEXTURE24=34008,WebGLContext.TEXTURE25=34009,WebGLContext.TEXTURE26=34010,WebGLContext.TEXTURE27=34011,WebGLContext.TEXTURE28=34012,WebGLContext.TEXTURE29=34013,WebGLContext.TEXTURE30=34014,WebGLContext.TEXTURE31=34015,WebGLContext.ACTIVE_TEXTURE=34016,WebGLContext.REPEAT=10497,WebGLContext.CLAMP_TO_EDGE=33071,WebGLContext.MIRRORED_REPEAT=33648,WebGLContext.FLOAT_VEC2=35664,WebGLContext.FLOAT_VEC3=35665,WebGLContext.FLOAT_VEC4=35666,WebGLContext.INT_VEC2=35667,WebGLContext.INT_VEC3=35668,WebGLContext.INT_VEC4=35669,WebGLContext.BOOL=35670,WebGLContext.BOOL_VEC2=35671,WebGLContext.BOOL_VEC3=35672,WebGLContext.BOOL_VEC4=35673,WebGLContext.FLOAT_MAT2=35674,WebGLContext.FLOAT_MAT3=35675,WebGLContext.FLOAT_MAT4=35676,WebGLContext.SAMPLER_2D=35678,WebGLContext.SAMPLER_CUBE=35680,WebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=34338,WebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=34339,WebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=34340,WebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=34341,WebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,WebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=34373,WebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,WebGLContext.COMPILE_STATUS=35713,WebGLContext.LOW_FLOAT=36336,WebGLContext.MEDIUM_FLOAT=36337,WebGLContext.HIGH_FLOAT=36338,WebGLContext.LOW_INT=36339,WebGLContext.MEDIUM_INT=36340,WebGLContext.HIGH_INT=36341,WebGLContext.FRAMEBUFFER=36160,WebGLContext.RENDERBUFFER=36161,WebGLContext.RGBA4=32854,WebGLContext.RGB5_A1=32855,WebGLContext.RGB565=36194,WebGLContext.DEPTH_COMPONENT16=33189,WebGLContext.STENCIL_INDEX=6401,WebGLContext.STENCIL_INDEX8=36168,WebGLContext.DEPTH_STENCIL=34041,WebGLContext.RENDERBUFFER_WIDTH=36162,WebGLContext.RENDERBUFFER_HEIGHT=36163,WebGLContext.RENDERBUFFER_INTERNAL_FORMAT=36164,WebGLContext.RENDERBUFFER_RED_SIZE=36176,WebGLContext.RENDERBUFFER_GREEN_SIZE=36177,WebGLContext.RENDERBUFFER_BLUE_SIZE=36178,WebGLContext.RENDERBUFFER_ALPHA_SIZE=36179,WebGLContext.RENDERBUFFER_DEPTH_SIZE=36180,WebGLContext.RENDERBUFFER_STENCIL_SIZE=36181,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,WebGLContext.COLOR_ATTACHMENT0=36064,WebGLContext.DEPTH_ATTACHMENT=36096,WebGLContext.STENCIL_ATTACHMENT=36128,WebGLContext.DEPTH_STENCIL_ATTACHMENT=33306,WebGLContext.NONE=0,WebGLContext.FRAMEBUFFER_COMPLETE=36053,WebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,WebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,WebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,WebGLContext.FRAMEBUFFER_UNSUPPORTED=36061,WebGLContext.FRAMEBUFFER_BINDING=36006,WebGLContext.RENDERBUFFER_BINDING=36007,WebGLContext.MAX_RENDERBUFFER_SIZE=34024,WebGLContext.INVALID_FRAMEBUFFER_OPERATION=1286,WebGLContext.UNPACK_FLIP_Y_WEBGL=37440,WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,WebGLContext.CONTEXT_LOST_WEBGL=37442,WebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,WebGLContext.BROWSER_DEFAULT_WEBGL=37444,WebGLContext._extTextureFilterAnisotropic=null,WebGLContext._compressedTextureS3tc=null,WebGLContext._compressedTexturePvrtc=null,WebGLContext._compressedTextureEtc1=null,WebGLContext._angleInstancedArrays=null,WebGLContext._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],WebGLContext._useProgram=null,WebGLContext._depthTest=!0,WebGLContext._depthMask=!0,WebGLContext._blend=!1,WebGLContext._cullFace=!1,WebGLContext._activedTextureID=33984,r(WebGLContext,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_srcAlpha",function(){return this._srcAlpha=1},"_dstAlpha",function(){return this._dstAlpha=0},"_frontFace",function(){return this._frontFace=2305}]),WebGLContext}()),K=function(){function Buffer(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,this._glBuffer=lt.instance.createBuffer()}n(Buffer,"laya.webgl.utils.Buffer");var t=Buffer.prototype;return t._bindForVAO=function(){},t.bind=function(){return!1},t.destroy=function(){this._glBuffer&&(lt.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)},a(0,t,"bufferUsage",function(){return this._bufferUsage}),Buffer._bindedVertexBuffer=null,Buffer._bindedIndexBuffer=null,Buffer}(),Z=function(){function InlcudeFile(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"===t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var n=et.splitToWords(t.substr(e,i-e),null);"code"==n[1]?this.codes[n[2]]=t.substr(i+1,r-i-1):"function"==n[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[n[3]]=t.substr(i+1,r-i-1),this.funnames+=n[3]+";"),e=r+1}}n(InlcudeFile,"laya.webgl.utils.InlcudeFile");var t=InlcudeFile.prototype;return t.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},t.getFunsScript=function(t){var e="";for(var i in this.funs)t.indexOf(i+";")>=0&&(e+=this.funs[i]);return e},InlcudeFile}(),q=function(){function BlendMode(){}return n(BlendMode,"laya.webgl.canvas.BlendMode"),BlendMode._init_=function(t){BlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut],BlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut]},BlendMode.BlendNormal=function(t){j.setBlendFunc(t,1,771)},BlendMode.BlendAdd=function(t){j.setBlendFunc(t,1,772)},BlendMode.BlendMultiply=function(t){j.setBlendFunc(t,774,771)},BlendMode.BlendScreen=function(t){j.setBlendFunc(t,1,1)},BlendMode.BlendOverlay=function(t){j.setBlendFunc(t,1,769)},BlendMode.BlendLight=function(t){j.setBlendFunc(t,1,1)},BlendMode.BlendNormalTarget=function(t){j.setBlendFunc(t,1,771)},BlendMode.BlendAddTarget=function(t){j.setBlendFunc(t,1,772)},BlendMode.BlendMultiplyTarget=function(t){j.setBlendFunc(t,774,771)},BlendMode.BlendScreenTarget=function(t){j.setBlendFunc(t,1,1)},BlendMode.BlendOverlayTarget=function(t){j.setBlendFunc(t,1,769)},BlendMode.BlendLightTarget=function(t){j.setBlendFunc(t,1,1)},BlendMode.BlendMask=function(t){j.setBlendFunc(t,0,770)},BlendMode.BlendDestinationOut=function(t){j.setBlendFunc(t,0,0)},BlendMode.activeBlendFunction=null,BlendMode.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],BlendMode.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},BlendMode.NORMAL="normal",BlendMode.ADD="add",BlendMode.MULTIPLY="multiply",BlendMode.SCREEN="screen",BlendMode.OVERLAY="overlay",BlendMode.LIGHT="light",BlendMode.MASK="mask",BlendMode.DESTINATIONOUT="destination-out",BlendMode.LIGHTER="lighter",BlendMode.fns=[],BlendMode.targetFns=[],BlendMode}(),$=function(){function WebGL(){}return n(WebGL,"laya.webgl.WebGL"),WebGL._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},WebGL._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},WebGL._uint16ArraySlice=function(t){var e,i=arguments,r=0,n=0;if(0===i.length)for(r=this.length,e=new Uint16Array(r),n=0;n<r;n++)e[n]=this[n];else if(2===i.length){var a=i[0],s=i[1];if(s>a)for(r=s-a,e=new Uint16Array(r),n=a;n<s;n++)e[n-a]=this[n];else e=new Uint16Array(0)}return e},WebGL._nativeRender_enable=function(){WebGL.isNativeRender_enable||(WebGL.isNativeRender_enable=!0,x.create=function(t,e){var i=new Pt(t,e,1,!1,!1);return i.wrapModeU=1,i.wrapModeV=1,i},j.__init_native(),Wt.prototype.uploadTexture2D=function(t){var e=j;e.bindTexture(laya.webgl.WebGL.mainContext,e.TEXTURE_2D,t)},W.width=h.window.innerWidth,W.height=h.window.innerHeight,C.measureText=function(e,i){return t.conchTextCanvas.font=i,t.conchTextCanvas.measureText(e)},C.enableNative=function(){m.supportWebGLPlusRendering&&(st.uploadShaderUniforms=st.uploadShaderUniformsForNative,N=t.GLCommandEncoder,lt=t.LayaGLContext);var e=y;e.prototype.render=e.prototype.renderToNative},C.clear=function(t){pt.set2DRenderConfig();var e=u.create(t).arrColor,i=lt.instance;e&&i.clearColor(e[0],e[1],e[2],e[3]),i.clear(17664),W.clear()},C.drawToCanvas=function(t,e,i,r,n,a){n-=t.x,a-=t.y,n|=0,a|=0,i|=0,r|=0;var s=new d(!1),o=s.getContext("2d");return s.size(i,r),o.asBitmap=!0,o._targets.start(),v.renders[e]._fun(t,o,n,a),o.flush(),o._targets.end(),o._targets.restore(),s},Ot.prototype._uv=Ot.flipyuv,Object.defineProperty(Ot.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}}),d.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=Ot.flipyuv,this._texture.bitmap=this._texture),this._texture})},WebGL._webglRender_enable=function(){m.isWebGL||(m.isWebGL=!0,C.initRender=function(t,e,i){var r=lt.instance=laya.webgl.WebGL.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];l.useWebGL2||i.shift();for(var r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:l.isStencil,alpha:l.isAlpha,antialias:l.isAntialias,premultipliedAlpha:l.premultipliedAlpha,preserveDrawingBuffer:l.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[r]&&(laya.webgl.WebGL._isWebGL2=!0),new lt,e}return null}(m._mainCanvas.source);if(!r)return!1;t.size(e,i),j.__init__(r),pt.__init__(),U.__init__();var n=new pt;m._context=n,t._setContext(n),laya.webgl.WebGL.shaderHighPrecision=!1;try{r.getShaderPrecisionFormat(35632,36338).precision?WebGL.shaderHighPrecision=!0:WebGL.shaderHighPrecision=!1}catch(t){}return lt.instance=r,A.__init__(),Mt.__init__(),w.__init__(),O.__init__(),yt.__int__(r),q._init_(r),!0},x.create=function(t,e,i){var r=new Pt(t,e,i,!1,!1);return r.wrapModeU=1,r.wrapModeV=1,r},C.createRenderSprite=function(t,e){return new xt(t,e)},C.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},C.clear=function(t){pt.set2DRenderConfig(),W.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=m.context,r=0==e._submits._length||l.preserveDrawingBuffer?u.create(t).arrColor:i.stage._wgColor;r?e.clearBG(r[0],r[1],r[2],r[3]):e.clearBG(0,0,0,0),W.clear()},C.drawToCanvas=function(t,e,i,r,n,a){n-=t.x,a-=t.y,n|=0,a|=0,i|=0,r|=0;var s=new pt;s.size(i,r),s.asBitmap=!0,s._targets.start(),v.renders[e]._fun(t,s,n,a),s.flush(),s._targets.end(),s._targets.restore();var o=s._targets.getData(0,0,i,r);s.destroy();for(var h=new ImageData(i,r),u=4*i,l=(new Uint8Array(u),h.data),c=r-1,_=c*u,f=0;c>=0;c--)l.set(o.subarray(f,f+u),_),_-=u,f+=u;var x=new d(!0);return x.size(i,r),x.getContext("2d").putImageData(h,0,0),x},C.getTexturePixels=function(t,e,i,r,n){var a=0,s=0,o=0,h=t.bitmap,u=h.width,l=h.height;if(e+r>u&&(r-=e+r-u),i+n>l&&(n-=i+n-l),r<=0||n<=0)return null;var c=4*r,_=null;try{_=h.getPixels()}catch(t){}if(_){if(0==e&&0==i&&r==u&&n==l)return _;var f=new Uint8Array(r*n*4);for(a=4*e,s=(i+n-1)*(c=4*u)+4*e,o=n-1;o>=0;o--)f.set(v.slice(s,s+4*r),a),a+=c,s-=c;return f}var d=new pt;d.size(r,n),d.asBitmap=!0;var x=null;if(0!=e||0!=i||r!=u||n!=l){var p=(x=t.uv.concat())[0],b=x[1],T=(x[2]-p)/u,m=(x[7]-b)/l;x=[p+e*T,b+i*m,p+(e+r)*T,b+i*m,p+(e+r)*T,b+(i+n)*m,p+e*T,b+(i+n)*m]}d._drawTextureM(t,0,0,r,n,null,1,x),d._targets.start(),d.flush(),d._targets.end(),d._targets.restore();var v=d._targets.getData(0,0,r,n);for(d.destroy(),f=new Uint8Array(r*n*4),a=0,s=(n-1)*c,o=n-1;o>=0;o--)f.set(v.slice(s,s+c),a),a+=c,s-=c;return f},_._filter=function(t,e,i,r){var n=e,a=this._next;if(a){var s=t.filters,o=s.length;if(1==o&&32==s[0].type)return e.save(),e.setColorFilter(s[0]),a._fun.call(a,t,e,i,r),void e.restore();var h,u=w.create(1,0),l=b.TEMP,c=n._curMat,_=p.create();c.copyTo(_);var f=0,d=0,x=null,m=t._cacheStyle.filterCache||null;if(m&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(f=50,d=25),(h=t.getBounds()).width<=0||h.height<=0)return;h.width+=f,h.height+=f,l.x=h.x*_.a+h.y*_.c,l.y=h.y*_.d+h.x*_.b,h.x=l.x,h.y=l.y,l.x=h.width*_.a+h.height*_.c,l.y=h.height*_.d+h.width*_.b,h.width=l.x,h.height=l.y}else{t._isHaveGlowFilter()&&(f=50,d=25),(h=new T).copyFrom(t.getSelfBounds()),h.x+=t.x,h.y+=t.y,h.x-=t.pivotX+4,h.y-=t.pivotY+4;var v=h.x,g=h.y;if(h.width+=f+8,h.height+=f+8,l.x=h.x*_.a+h.y*_.c,l.y=h.y*_.d+h.x*_.b,h.x=l.x,h.y=l.y,l.x=h.width*_.a+h.height*_.c,l.y=h.height*_.d+h.width*_.b,h.width=l.x,h.height=l.y,h.width<=0||h.height<=0)return;m&&G.releaseRT(m),x=G.getRT(h.width,h.height);var C=m=G.getRT(h.width,h.height);t._getCacheStyle().filterCache=m,n.pushRT(),n.useRT(x);var S=t.x-v+d,y=t.y-g+d;a._fun.call(a,t,e,S,y),n.useRT(C);for(var R=0;R<o;R++){0!=R&&(n.useRT(x),n.drawTarget(C,0,0,h.width,h.height,p.TEMP.identity(),u,null,q.TOINT.overlay),n.useRT(C));var E=s[R];switch(E.type){case 16:case 8:E._glRender&&E._glRender.render(x,e,h.width,h.height,E);break;case 32:n.setColorFilter(E),n.drawTarget(x,0,0,h.width,h.height,p.EMPTY.identity(),w.create(1,0)),n.setColorFilter(null)}}n.popRT()}if(i=i-d-t.x,r=r-d-t.y,l.setTo(i,r),_.transformPoint(l),i=l.x+h.x,r=l.y+h.y,n._drawRenderTexture(m,i,r,h.width,h.height,p.TEMP.identity(),1,Ot.defuv),x){var A=ft.create([x],function(t){t.destroy()},this);x=null,e.addRenderObject(A)}_.destroy()}},d.prototype.getTexture=function(){if(!this._texture){var t=new Pt;t.loadImageSource(this.source),this._texture=new L(t)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=WebGL._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=WebGL._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=WebGL._uint8ArraySlice))},WebGL.enable=function(){return h.__init__(),!!h._supportWebGL&&(WebGL._webglRender_enable(),m.isConchApp&&WebGL._nativeRender_enable(),!0)},WebGL.onStageResize=function(t,e){null!=WebGL.mainContext&&(WebGL.mainContext.viewport(0,0,t,e),W.width=t,W.height=e)},WebGL.mainContext=null,WebGL.shaderHighPrecision=!1,WebGL._isWebGL2=!1,WebGL.isNativeRender_enable=!1,WebGL}(),J=function(){function EarcutNode(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return n(EarcutNode,"laya.webgl.shapes.EarcutNode"),EarcutNode}(),tt=(function(){function WebGLCacheAsNormalCanvas(t,e){this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._oldMesh=null,this._oldPathMesh=null,this._oldTriMesh=null,this._oldMeshList=null,this.oldTx=0,this.oldTy=0,this.cachedClipInfo=new p,this.invMat=new p,this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}n(WebGLCacheAsNormalCanvas,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var t=WebGLCacheAsNormalCanvas.prototype;t.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.context._incache=!0,this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0,this._mesh=St.getAMesh(),this._pathMesh=gt.getAMesh(),this._triangleMesh=vt.getAMesh(),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=U.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()},t.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var e=this.submitEndPos-this.submitStartPos,i=0;i<e;i++)this.submits.push(t[this.submitStartPos+i]);t._length-=e,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=U.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null,this.context._incache=!1},t.isCacheValid=function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty},t.flushsubmit=function(){var t=U.RENDERBASE;this.submits.forEach(function(e){e!=U.RENDERBASE&&(U.preRender=t,t=e,e.renderSubmit())})},t.releaseMem=function(){},r(WebGLCacheAsNormalCanvas,["matI",function(){return this.matI=new p}])}(),function(){function CharRenderInfo(){this.char="",this.tex=null,this.deleted=!1,this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1,this.uv=new Array(8)}return n(CharRenderInfo,"laya.webgl.resource.CharRenderInfo"),CharRenderInfo.prototype.touch=function(){var t=R.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t},CharRenderInfo}()),et=function(){function ShaderCompile(t,e,i,r){this._clearCR=new RegExp("\r","g");var n=this;function _compile(t){t=t.replace(n._clearCR,"");var e=[],i=new V(e);return n._compileToTree(i,t.split("\n"),0,e,r),i}var a=h.now();this._VS=_compile(t),this._PS=_compile(e),this._nameMap=i,h.now()-a>2&&console.log("ShaderCompile use time:"+(h.now()-a)+"  size:"+t.length+"/"+e.length)}n(ShaderCompile,"laya.webgl.utils.ShaderCompile");var t=ShaderCompile.prototype;return t._compileToTree=function(t,e,i,r,n){var a,s,o,h,u,l,c,_=0,f=0,d=0,x=0;for(f=i;f<e.length;f++)if(!((o=e[f]).length<1)&&0!==(_=o.indexOf("//"))){if(_>=0&&(o=o.substr(0,_)),a=c||new V(r),c=null,a.text=o,a.noCompile=!0,(_=o.indexOf("#"))>=0){for(h="#",x=_+1,d=o.length;x<d;x++){var p=o.charAt(x);if(" "===p||"\t"===p||"?"===p)break;h+=p}switch(a.name=h,h){case"#ifdef":case"#ifndef":if(a.src=o,a.noCompile=null!=o.match(/[!&|()=<>]/),a.noCompile?console.log("function():Boolean{return "+o.substr(_+a.name.length)+"}"):(l=o.replace(/^\s*/,"").split(/\s+/),a.setCondition(l[1],"#ifdef"===h?1:2),a.text="//"+a.text),a.setParent(t),t=a,n)for(l=o.substr(x).split(ShaderCompile._splitToWordExps3),x=0;x<l.length;x++)(o=l[x]).length&&(n[o]=!0);continue;case"#if":if(a.src=o,a.noCompile=!0,a.setParent(t),t=a,n)for(l=o.substr(x).split(ShaderCompile._splitToWordExps3),x=0;x<l.length;x++)(o=l[x]).length&&"defined"!=o&&(n[o]=!0);continue;case"#else":a.src=o,s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.condition=s.condition,a.conditionType=1==s.conditionType?2:1,a.text="//"+a.text+" "+s.text+" "+a.conditionType),a.setParent(t),t=a;continue;case"#endif":s=(t=t.parent).childs[t.childs.length-1],a.noCompile=s.noCompile,a.noCompile||(a.text="//"+a.text),a.setParent(t);continue;case"#include":l=ShaderCompile.splitToWords(o,null);var b=ShaderCompile.includes[l[1]];if(!b)throw"ShaderCompile error no this include file:"+l[1];if((_=l[0].indexOf("?"))<0){a.setParent(t),o=b.getWith("with"==l[2]?l[3]:null),this._compileToTree(a,o.split("\n"),0,r,n),a.text="";continue}a.setCondition(l[0].substr(_+1),1),a.text=b.getWith("with"==l[2]?l[3]:null);break;case"#import":u=(l=ShaderCompile.splitToWords(o,null))[1],r.push({node:a,file:ShaderCompile.includes[u],ofs:a.text.length});continue}}else{if((s=t.childs[t.childs.length-1])&&!s.name){r.length>0&&ShaderCompile.splitToWords(o,s),c=a,s.text+="\n"+o;continue}r.length>0&&ShaderCompile.splitToWords(o,a)}a.setParent(t)}},t.createShader=function(t,e,i,r){var n={},a="";if(t)for(var s in t)a+="#define "+s+"\n",n[s]=!0;var o=this._VS.toscript(n,[]),h=this._PS.toscript(n,[]);return(i||Wt.create)(a+o.join("\n"),a+h.join("\n"),e,this._nameMap,r)},ShaderCompile._parseOne=function(t,e,i,r,n,a){var s={type:ShaderCompile.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return a&&("attribute"==n?t.push(s):e.push(s)),":"==i[r+3]&&(s.type=i[r+4],r+=2),r+=2},ShaderCompile.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(ShaderCompile.includes[t])throw new Error("add shader include file err, has add:"+t);ShaderCompile.includes[t]=new Z(e)},ShaderCompile.preGetParams=function(t,e){var i=[t,e],r={},n=[],a=[],s={},o=[];r.attributes=n,r.uniforms=a,r.defines=s;for(var h=0,u=0,l=0;l<2;l++){i[l]=i[l].replace(ShaderCompile._removeAnnotation,"");var c,_=i[l].match(ShaderCompile._reg);for(h=0,u=_.length;h<u;h++){var f=_[h];if("attribute"==f||"uniform"==f)h=ShaderCompile._parseOne(n,a,_,h,f,!0);else{if("#define"==f){o[f=_[++h]]=1;continue}if("#ifdef"==f){s[c=_[++h]]=s[c]||[];for(h++;h<u;h++)if("attribute"==(f=_[h])||"uniform"==f)h=ShaderCompile._parseOne(n,a,_,h,f,o[c]);else if("#else"==f)for(h++;h<u;h++)if("attribute"==(f=_[h])||"uniform"==f)h=ShaderCompile._parseOne(n,a,_,h,f,!o[c]);else if("#endif"==f)break}}}}return r},ShaderCompile.splitToWords=function(t,e){for(var i,r,n=[],a=-1,s=0,o=t.length;s<o;s++)if(i=t.charAt(s)," \t=+-*/&%!<>()'\",;".indexOf(i)>=0){if(a>=0&&s-a>1&&(r=t.substr(a,s-a),n.push(r)),'"'==i||"'"==i){var h=t.indexOf(i,s+1);if(h<0)throw"Sharder err:"+t;n.push(t.substr(s+1,h-s-1)),s=h,a=-1;continue}"("==i&&e&&n.length>0&&(r=n[n.length-1]+";","vec4;main;".indexOf(r)<0&&(e.useFuns+=r)),a=-1}else a<0&&(a=s);return a<o&&o-a>1&&(r=t.substr(a,o-a),n.push(r)),n},ShaderCompile.IFDEF_NO=0,ShaderCompile.IFDEF_YES=1,ShaderCompile.IFDEF_ELSE=2,ShaderCompile.IFDEF_PARENT=3,ShaderCompile._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),ShaderCompile._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),ShaderCompile._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),ShaderCompile.includes={},r(ShaderCompile,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),ShaderCompile}(),it=function(){function ShaderDefinesBase(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}n(ShaderDefinesBase,"laya.webgl.shader.ShaderDefinesBase");var t=ShaderDefinesBase.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||ShaderDefinesBase._toText(this._value,this._int2name,this._int2nameMap)},ShaderDefinesBase._reg=function(t,e,i,r){i[t]=e,r[e]=t},ShaderDefinesBase._toText=function(t,e,i){var r=i[t];if(r)return r;for(var n={},a=1,s=0;s<32&&!((a=1<<s)>t);s++)if(t&a){var o=e[a];o&&(n[o]="")}return i[t]=n,n},ShaderDefinesBase._toInt=function(t,e){for(var i=t.split("."),r=0,n=0,a=i.length;n<a;n++){var s=e[i[n]];if(!s)throw new Error("Defines to int err:"+t+"/"+i[n]);r|=s}return r},ShaderDefinesBase}(),rt=function(){function TextAtlas(){this.texWidth=1024,this.texHeight=1024,this.atlasgrid=null,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=at.atlasWidth,this.texture=wt.getTextTexture(this.texWidth,this.texHeight),this.texWidth/TextAtlas.atlasGridW>256&&(TextAtlas.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new ot(this.texWidth/TextAtlas.atlasGridW,this.texHeight/TextAtlas.atlasGridW,this.texture.id)}n(TextAtlas,"laya.webgl.text.TextAtlas");var t=TextAtlas.prototype;return t.setProtecteDist=function(t){this.protectDist=t},t.getAEmpty=function(t,e,i){var r=this.atlasgrid.addRect(1,Math.ceil(t/TextAtlas.atlasGridW),Math.ceil(e/TextAtlas.atlasGridW),i);return r&&(i.x*=TextAtlas.atlasGridW,i.y*=TextAtlas.atlasGridW),r},t.destroy=function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()},t.printDebugInfo=function(){},a(0,t,"usedRate",function(){return this.atlasgrid._used}),TextAtlas.atlasGridW=16,TextAtlas}(),nt=function(){function SubmitTarget(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new ht}n(SubmitTarget,"laya.webgl.submit.SubmitTarget");var t=SubmitTarget.prototype;return i.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=$.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),R.renderBatches++,R.trianglesFaces+=this._numEle/3,$.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(q.activeBlendFunction!==q.fns[this.blendType]){var t=$.mainContext;t.enable(3042),q.fns[this.blendType](t),q.activeBlendFunction=q.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=SubmitTarget.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},SubmitTarget.create=function(t,e,i,r){var n=SubmitTarget.POOL._length?SubmitTarget.POOL[--SubmitTarget.POOL._length]:new SubmitTarget;if(n._mesh=e,n.srcRT=r,n._startIdx=e.indexNum*dt.BYTES_PIDX,n._ref=1,n._key.clear(),n._numEle=0,n.blendType=t._nBlendType,n._key.blendShader=n.blendType,n.shaderValue=i,n.shaderValue.setValue(t._shader2D),t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return n},SubmitTarget.POOL=(SubmitTarget.POOL=[],SubmitTarget.POOL._length=0,SubmitTarget.POOL),SubmitTarget}(),at=function(){function TextRender(){this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.bmpData32=null,this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.textureMem=0,this.fontStr=null,this.textAtlases=[],this.isoTextures=[],this.tmpAtlasPos=new b;var t=!1,e=i.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),h.onMiniGame&&!t&&(TextRender.isWan1Wan=!0),h.onLimixiu&&(TextRender.isWan1Wan=!0),this.charRender=m.isConchApp?new Lt:new At(TextRender.atlasWidth,TextRender.atlasWidth,TextRender.scaleFontWithCtx,!TextRender.isWan1Wan,!1),TextRender.textRenderInst=this,i.textRender=this,TextRender.atlasWidth2=TextRender.atlasWidth*TextRender.atlasWidth}n(TextRender,"laya.webgl.text.TextRender");var t=TextRender.prototype;return t.setFont=function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,r=e>>16&255,n=e>>8&255,a=255&e,s=t._size/TextRender.standardFontSize;this.fontSizeOffX=Math.ceil(i*s),this.fontSizeOffY=Math.ceil(r*s),this.fontSizeW=Math.ceil(n*s),this.fontSizeH=Math.ceil(a*s),this.fontStr=t._font.replace("italic","")}},t.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(i>=e)return null;for(var r=i,n=0;r<e;r++){var a=t.charCodeAt(r);if(a>>>11==27){if(1==n)break;n=1,r++}else if(65038===a||65039===a);else if(8205==a)n=2;else if(0==n)n=1;else if(1==n)break}return this._curStrPos=r,t.substring(i,r)},t.filltext=function(t,e,i,r,n,a,s,o,h,u){if(void 0===u&&(u=0),!(e.length<=0)){var l=f.Parse(n),_=0;switch(h){case"center":_=c.ENUM_TEXTALIGN_CENTER;break;case"right":_=c.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,r,l,a,s,o,_,u)}},t.fillWords=function(t,e,i,r,n,a,s,o){if(e&&!(e.length<=0)){var h=f.Parse(n);this._fast_filltext(t,null,e,i,r,h,a,s,o,0,0)}},t._fast_filltext=function(t,e,i,r,n,a,s,o,h,u,l){if(void 0===l&&(l=0),!(e&&e.length<1||i&&i.length<1)){if(h<0&&(h=0),this.setFont(a),this.fontScaleX=this.fontScaleY=1,!m.isConchApp&&TextRender.scaleFontWithCtx){var _=1,f=1;if(m.isConchApp?(_=t._curMat.getScaleX(),f=t._curMat.getScaleY()):(_=t.getMatScaleX(),f=t.getMatScaleY()),_<1e-4||f<.1)return;_>1&&(this.fontScaleX=_),f>1&&(this.fontScaleY=f)}a._italic&&(t._italicDeg=13);var d=e,x=!i&&e instanceof laya.utils.WordText,p=e,b=!!i,T=x?d.pageChars:[],v=0;switch(x?(p=d._text,(v=d.width)<0&&(v=d.width=this.charRender.getWidth(this.fontStr,p))):v=p?this.charRender.getWidth(this.fontStr,p):0,u){case c.ENUM_TEXTALIGN_CENTER:r-=v/2;break;case c.ENUM_TEXTALIGN_RIGHT:r-=v}d&&T&&this.hasFreedText(T)&&(T=d.pageChars=[]);var g=null,C=(x||TextRender.forceWholeRender,this.renderPerChar=!x||TextRender.forceSplitRender||b||x&&d.splitRender);if(!T||T.length<1)if(C){var S,y=0,R=0;for(this._curStrPos=0;;){if(b){var E=i[this._curStrPos++];E?(S=E.char,y=E.x,R=E.y):S=null}else S=this.getNextChar(p);if(!S)break;if(!(g=this.getCharRenderInfo(S,a,s,o,h,!1)))break;if(g.isSpace);else{var A=T[g.tex.id];A||(T[g.tex.id]=A=[]),m.isConchApp?A.push({ri:g,x:y,y:R,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}):A.push({ri:g,x:y+1/this.fontScaleX,y:R,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}),y+=g.width}}}else{var L=TextRender.noAtlas||v*this.fontScaleX>TextRender.atlasWidth;g=this.getCharRenderInfo(p,a,s,o,h,L),m.isConchApp?T[0]=[{ri:g,x:0,y:0,w:g.bmpWidth/this.fontScaleX,h:g.bmpHeight/this.fontScaleY}]:T[0]=[{ri:g,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(g.bmpWidth-2)/this.fontScaleX,h:(g.bmpHeight-1)/this.fontScaleY}]}this._drawResortedWords(t,r,n,T),t._italicDeg=0}},t._drawResortedWords=function(t,e,i,r){var n=t._charSubmitCache&&t._charSubmitCache._enbale,a=t._curMat;for(var s in r){var o=r[s],h=o.length;if(!(h<=0))for(var u=0;u<h;u++){var l=o[u],c=l.ri;c.isSpace||(c.touch(),t.drawTexAlign=!0,m.isConchApp?t._drawTextureM(c.tex.texture,e+l.x-c.orix,i+l.y-c.oriy,l.w,l.h,null,1,c.uv):t._inner_drawTexture(c.tex.texture,c.tex.texture.bitmap.id,e+l.x-c.orix,i+l.y-c.oriy,l.w,l.h,a,c.uv,1,n),t.touches&&t.touches.push(c))}}},t.hasFreedText=function(t){for(var e in t)for(var i=t[e],r=0,n=i.length;r<n;r++){var a=i[r].ri;if(a.deleted||a.tex.__destroyed)return!0}return!1},t.getCharRenderInfo=function(t,e,i,r,n,a){void 0===a&&(a=!1);var s=this.mapFont[e._family];null==s&&(this.mapFont[e._family]=s=this.fontID++);var o=t+"_"+s+"_"+e._size+"_"+i;n>0&&(o+="_"+r+n),e._bold&&(o+="P"),1==this.fontScaleX&&1==this.fontScaleY||(o+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var h=0,u=this.textAtlases.length,l=null,c=null;if(!a)for(h=0;h<u;h++)if(l=(c=this.textAtlases[h]).charMaps[o])return l.touch(),l;l=new tt,this.charRender.scale(this.fontScaleX,this.fontScaleY),l.char=t,l.height=e._size;var _=e._size/3|0,f=null,d=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(d>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,d+2*_)),a){f=this.charRender.getCharBmp(t,this.fontStr,n,i,r,l,_,_,_,_,null);var x=wt.getTextTexture(f.width,f.height);x.addChar(f,0,0,l.uv),l.tex=x,l.orix=_,l.oriy=_,x.ri=l,this.isoTextures.push(x)}else{var p=t.length,b=1*n,T=Math.ceil((this.fontSizeW+2*b)*this.fontScaleX),m=Math.ceil((this.fontSizeH+2*b)*this.fontScaleY);TextRender.imgdtRect[0]=(_-this.fontSizeOffX-b)*this.fontScaleX|0,TextRender.imgdtRect[1]=(_-this.fontSizeOffY-b)*this.fontScaleY|0,this.renderPerChar||1==p?(TextRender.imgdtRect[2]=Math.max(d,T),TextRender.imgdtRect[3]=Math.max(d,m)):(TextRender.imgdtRect[2]=-1,TextRender.imgdtRect[3]=m),f=this.charRender.getCharBmp(t,this.fontStr,n,i,r,l,_,_,_,_,TextRender.imgdtRect),c=this.addBmpData(f,l),TextRender.isWan1Wan?(l.orix=_,l.oriy=_):(l.orix=this.fontSizeOffX+b,l.oriy=this.fontSizeOffY+b),c.charMaps[o]=l}return l},t.addBmpData=function(t,e){for(var i=t.width,r=t.height,n=this.textAtlases.length,a=null,s=!1,o=0;o<n&&!(s=(a=this.textAtlases[o]).getAEmpty(i,r,this.tmpAtlasPos));o++);if(!s){if(a=new rt,this.textAtlases.push(a),!(s=a.getAEmpty(i,r,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return s&&(a.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=a.texture),a},t.GC=function(t){for(var e=0,i=this.textAtlases.length,r=TextRender.destroyAtlasDt,n=0,a=-1,s=0,o=null,h=null;e<i;e++){if(o=(h=this.textAtlases[e]).texture){o.curUsedCovRate,n+=o.curUsedCovRateAtlas;var u=h.usedRate-o.curUsedCovRateAtlas;s<u&&(s=u,a=e)}R.loopCount-h.texture.lastTouchTm>r&&(TextRender.showLog&&console.log(h.texture.id),h.destroy(),this.textAtlases[e]=this.textAtlases[i-1],i--,e--)}for(this.textAtlases.length=i,i=this.isoTextures.length,e=0;e<i;e++)o=this.isoTextures[e],R.loopCount-o.lastTouchTm>TextRender.destroyUnusedTextureDt&&(o.ri.deleted=!0,o.ri.tex=null,o.destroy(),this.isoTextures[e]=this.isoTextures[i-1],i--,e--);var l=this.textAtlases.length>1&&this.textAtlases.length-n>=2;(TextRender.atlasWidth*TextRender.atlasWidth*4*this.textAtlases.length>TextRender.cleanMem||l||TextRender.simClean)&&(TextRender.simClean=!1,TextRender.showLog&&console.log("清理使用率低的贴图。总使用率:",n,":",this.textAtlases.length,"最差贴图:"+a),a>=0&&((h=this.textAtlases[a]).destroy(),this.textAtlases[a]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),wt.clean()},t.cleanAtlases=function(){},t.getCharBmp=function(t){},t.checkBmpLine=function(t,e,i,r){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var n=t.width*e+i,a=i;a<r;a++)if(0!=this.bmpData32[n++])return!0;return!1},t.updateBbx=function(t,e,i){void 0===i&&(i=!1);var r=t.width,n=t.height,a=0,s=e[1],o=0,h=s;if(this.checkBmpLine(t,s,0,r))for(;;){if((h=(s+o)/2|0)+1>=s){e[1]=h;break}this.checkBmpLine(t,h,0,r)?s=h:o=h}if(e[3]>n)e[3]=n;else if(h=s=e[3],o=n,this.checkBmpLine(t,s,0,r))for(;;){if((h=(s+o)/2|0)-1<=s){e[3]=h;break}this.checkBmpLine(t,h,0,r)?s=h:o=h}if(!i){var u=e[0],l=r*e[1];for(h=e[1];h<e[3];h++){for(a=0;a<u;a++)if(0!=this.bmpData32[l+a]){u=a;break}l+=r}e[0]=u;var c=e[2];for(l=r*e[1],h=e[1];h<e[3];h++){for(a=c;a<r;a++)if(0!=this.bmpData32[l+a]){c=a;break}l+=r}e[2]=c}},t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var i="bold "+TextRender.standardFontSize+"px "+t;if(TextRender.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"有"),this.fontSizeH=1.5*TextRender.standardFontSize;var r=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=r,r}TextRender.pixelBBX[0]=TextRender.standardFontSize/2,TextRender.pixelBBX[1]=TextRender.standardFontSize/2,TextRender.pixelBBX[2]=TextRender.standardFontSize,TextRender.pixelBBX[3]=TextRender.standardFontSize;var n=16,a=16;this.charRender.scale(1,1),TextRender.tmpRI.height=TextRender.standardFontSize;var s=this.charRender.getCharBmp("g",i,0,"red",null,TextRender.tmpRI,n,a,16,16);m.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),this.updateBbx(s,TextRender.pixelBBX,!1),s=this.charRender.getCharBmp("有",i,0,"red",null,TextRender.tmpRI,a,a,16,16),m.isConchApp&&(s.data=new Uint8ClampedArray(s.data)),this.bmpData32=new Uint32Array(s.data.buffer),TextRender.pixelBBX[2]<n+TextRender.tmpRI.width&&(TextRender.pixelBBX[2]=n+TextRender.tmpRI.width),this.updateBbx(s,TextRender.pixelBBX,!1),m.isConchApp&&(n=0,a=0);var o=Math.max(n-TextRender.pixelBBX[0],0)<<24|Math.max(a-TextRender.pixelBBX[1],0)<<16|TextRender.pixelBBX[2]-TextRender.pixelBBX[0]<<8|TextRender.pixelBBX[3]-TextRender.pixelBBX[1];return this.fontSizeInfo[t]=o,o},t.printDbgInfo=function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+TextRender.atlasWidth+"x"+TextRender.atlasWidth," 用canvas:",TextRender.isWan1Wan),console.log("图集占用空间:"+TextRender.atlasWidth*TextRender.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,r=e>>16&255,n=e>>8&255,a=255&e;console.log("    "+t," off:",i,r," size:",n,a)}var s=0;console.log("缓存数据:");var o=0,h=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=R.loopCount-t.texture.lastTouchTm,r=i>0?i+"帧以前":"当前帧";for(var n in o+=t.texture.curUsedCovRate,h+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+r+")--:"),t.charMaps){var a=t.charMaps[n];console.log("     off:",a.orix,a.oriy," bmp宽高:",a.bmpWidth,a.bmpHeight,"无效:",a.deleted,"touchdt:",R.loopCount-a.touchTick,"位置:",a.uv[0]*TextRender.atlasWidth|0,a.uv[1]*TextRender.atlasWidth|0,"字符:",a.char,"key:",n),s++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",R.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",s,"总使用率:",o,"总当前图集使用率:",h)},t.showAtlas=function(t,e,r,n,a,s){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var o=new S,h=this.textAtlases[t].texture,u={width:TextRender.atlasWidth,height:TextRender.atlasWidth,sourceWidth:TextRender.atlasWidth,sourceHeight:TextRender.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return h._getSource()},bitmap:{id:h.id},_uv:L.DEF_UV};return o.size=function(t,i){return this.width=t,this.height=i,o.graphics.clear(),o.graphics.drawRect(0,0,o.width,o.height,e),o.graphics.drawTexture(u,0,0,o.width,o.height),this},o.graphics.drawRect(0,0,a,s,e),o.graphics.drawTexture(u,0,0,a,s),o.pos(r,n),i.stage.addChild(o),o},t.filltext_native=function(t,e,i,r,n,a,s,o,h,u,l){if(void 0===l&&(l=0),!(e&&e.length<=0||i&&i.length<1)){var _=f.Parse(a),d=0;switch(u){case"center":d=c.ENUM_TEXTALIGN_CENTER;break;case"right":d=c.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,r,n,_,s,o,h,d,l)}},TextRender.useOldCharBook=!1,TextRender.atlasWidth=2048,TextRender.noAtlas=!1,TextRender.forceSplitRender=!1,TextRender.forceWholeRender=!1,TextRender.scaleFontWithCtx=!0,TextRender.standardFontSize=32,TextRender.destroyAtlasDt=10,TextRender.checkCleanTextureDt=2e3,TextRender.destroyUnusedTextureDt=3e3,TextRender.cleanMem=104857600,TextRender.isWan1Wan=!1,TextRender.showLog=!1,TextRender.debugUV=!1,TextRender.atlasWidth2=4194304,TextRender.textRenderInst=null,TextRender.simClean=!1,r(TextRender,["tmpRI",function(){return this.tmpRI=new tt},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]),TextRender}(),st=function(){function LayaGLRunner(){}return n(LayaGLRunner,"laya.layagl.LayaGLRunner"),LayaGLRunner.uploadShaderUniforms=function(t,e,i,r){for(var n=i._data,a=e.getArrayData(),s=0,o=0,h=a.length;o<h;o++){var u=a[o];if(r||-1!==u.textureID){var l=n[u.dataOffset];null!=l&&(s+=u.fun.call(u.caller,u,l))}}return s},LayaGLRunner.uploadCustomUniform=function(t,e,i,r){var n=0,a=e[i];return a&&null!=r&&(n+=a.fun.call(a.caller,a,r)),n},LayaGLRunner.uploadShaderUniformsForNative=function(t,e,i){var r=0;i._runtimeCopyValues.length>0&&(r=1);var n=i._data;return t.uploadShaderUniforms(e,n,r)},LayaGLRunner}(),ot=function(){function AtlasGrid(t,e,i){this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._used=0,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this.atlasID=i,this._init(t,e)}n(AtlasGrid,"laya.webgl.text.AtlasGrid");var t=AtlasGrid.prototype;return t.addRect=function(t,e,i,r){return!!this._get(e,i,r)&&(this._fill(r.x,r.y,e,i,t),this._texCount++,!0)},t._release=function(){this._cells=null,this._rowInfo=null},t._init=function(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)},t._get=function(t,e,i){if(t>this._width||e>this._height)return!1;for(var r=-1,n=-1,a=this._width,s=this._height,o=this._cells,h=0;h<s;h++)if(!(this._rowInfo[h]<t))for(var u=0;u<a;){var l=3*(h*a+u);if(0!=o[l]||o[l+1]<t||o[l+2]<e)u+=o[l+1];else{r=u,n=h;for(var c=0;c<t;c++)if(o[3*c+l+2]<e){r=-1;break}if(!(r<0))return i.x=r,i.y=n,!0;u+=o[l+1]}}return!1},t._fill=function(t,e,i,r,n){var a=this._width,s=this._height;this._check(t+i<=a&&e+r<=s);for(var o=e;o<r+e;++o){this._check(this._rowInfo[o]>=i),this._rowInfo[o]-=i;for(var h=0;h<i;h++){var u=3*(t+o*a+h);this._check(0==this._cells[u]),this._cells[u]=n,this._cells[u+1]=i,this._cells[u+2]=r}}if(t>0)for(o=0;o<r;++o){var l=0;for(h=t-1;h>=0&&0==this._cells[3*((e+o)*a+h)];--h,++l);for(h=l;h>0;--h)this._cells[3*((e+o)*a+t-h)+1]=h,this._check(h>0)}if(e>0)for(h=t;h<t+i;++h){for(l=0,o=e-1;o>=0&&0==this._cells[3*(h+o*a)];--o,l++);for(o=l;o>0;--o)this._cells[3*(h+(e-o)*a)+2]=o,this._check(o>0)}this._used+=i*r/(this._width*this._height)},t._check=function(t){0==t&&console.log("xtexMerger 错误啦")},t._clear=function(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[r+1]=this._width-i,this._cells[r+2]=this._width-e}},AtlasGrid}(),ht=(function(){function ShaderValue(){}n(ShaderValue,"laya.webgl.shader.ShaderValue")}(),function(){function CharInternalTexture(t){this._par=null,this._loaded=!0,this.bitmap={},this.bitmap.id=t.id,this._par=t}n(CharInternalTexture,"laya.webgl.resource.CharInternalTexture"),CharInternalTexture.prototype._getSource=function(){return this._par._source}}(),function(){function SubmitKey(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}n(SubmitKey,"laya.webgl.submit.SubmitKey");var t=SubmitKey.prototype;return t.clear=function(){this.submitType=-1,this.blendShader=this.other=0},t.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},t.copyFrom2=function(t,e,i){this.other=i,this.submitType=e},t.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},t.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},t.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},t.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},SubmitKey}()),ut=function(){function SaveMark(){this._saveuse=0}n(SaveMark,"laya.webgl.canvas.save.SaveMark");var t=SaveMark.prototype;return i.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,SaveMark.POOL[SaveMark.POOL._length++]=this},SaveMark.Create=function(t){var e=SaveMark.POOL,i=e._length>0?e[--e._length]:new SaveMark;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i,i},SaveMark.POOL=D._createArray(),SaveMark}(),lt=function(){function LayaGL(){}n(LayaGL,"laya.layagl.LayaGL");var t=LayaGL.prototype;return t.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new N(this,t,e,i)},t.beginCommandEncoding=function(t){},t.endCommandEncoding=function(){},t.matrix4x4Multiply=function(t,e,i){},t.evaluateClipDatasRealTime=function(t,e,i,r){},LayaGL.getFrameCount=function(){return 0},LayaGL.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},LayaGL.createArrayBufferRef=function(t,e,i){},LayaGL.createArrayBufferRefs=function(t,e,i,r){},LayaGL.EXECUTE_JS_THREAD_BUFFER=0,LayaGL.EXECUTE_RENDER_THREAD_BUFFER=1,LayaGL.EXECUTE_COPY_TO_RENDER=2,LayaGL.EXECUTE_COPY_TO_RENDER3D=3,LayaGL.ARRAY_BUFFER_TYPE_DATA=0,LayaGL.ARRAY_BUFFER_TYPE_CMD=1,LayaGL.ARRAY_BUFFER_REF_REFERENCE=0,LayaGL.ARRAY_BUFFER_REF_COPY=1,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,LayaGL.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,LayaGL.instance=null,LayaGL}(),ct=function(){function Earcut(){}return n(Earcut,"laya.webgl.shapes.Earcut"),Earcut.earcut=function(t,e,i){i=i||2;var r,n,a,s,o,h,u,l=e&&e.length,c=l?e[0]*i:t.length,_=Earcut.linkedList(t,0,c,i,!0),f=[];if(!_)return f;if(l&&(_=Earcut.eliminateHoles(t,e,_,i)),t.length>80*i){r=a=t[0],n=s=t[1];for(var d=i;d<c;d+=i)(o=t[d])<r&&(r=o),(h=t[d+1])<n&&(n=h),o>a&&(a=o),h>s&&(s=h);u=0!==(u=Math.max(a-r,s-n))?1/u:0}return Earcut.earcutLinked(_,f,i,r,n,u),f},Earcut.linkedList=function(t,e,i,r,n){var a,s;if(n===Earcut.signedArea(t,e,i,r)>0)for(a=e;a<i;a+=r)s=Earcut.insertNode(a,t[a],t[a+1],s);else for(a=i-r;a>=e;a-=r)s=Earcut.insertNode(a,t[a],t[a+1],s);return s&&Earcut.equals(s,s.next)&&(Earcut.removeNode(s),s=s.next),s},Earcut.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!Earcut.equals(r,r.next)&&0!==Earcut.area(r.prev,r,r.next))r=r.next;else{if(Earcut.removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e},Earcut.earcutLinked=function(t,e,i,r,n,a,s){if(t){!s&&a&&Earcut.indexCurve(t,r,n,a);for(var o,h,u=t;t.prev!==t.next;)if(o=t.prev,h=t.next,a?Earcut.isEarHashed(t,r,n,a):Earcut.isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),Earcut.removeNode(t),t=h.next,u=h.next;else if((t=h)===u){s?1===s?(t=Earcut.cureLocalIntersections(t,e,i),Earcut.earcutLinked(t,e,i,r,n,a,2)):2===s&&Earcut.splitEarcut(t,e,i,r,n,a):Earcut.earcutLinked(Earcut.filterPoints(t,null),e,i,r,n,a,1);break}}},Earcut.isEar=function(t){var e=t.prev,i=t,r=t.next;if(Earcut.area(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Earcut.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&Earcut.area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0},Earcut.isEarHashed=function(t,e,i,r){var n=t.prev,a=t,s=t.next;if(Earcut.area(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,h=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,u=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,l=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,c=Earcut.zOrder(o,h,e,i,r),_=Earcut.zOrder(u,l,e,i,r),f=t.nextZ;f&&f.z<=_;){if(f!==t.prev&&f!==t.next&&Earcut.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&Earcut.area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&Earcut.pointInTriangle(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&Earcut.area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0},Earcut.cureLocalIntersections=function(t,e,i){var r=t;do{var n=r.prev,a=r.next.next;!Earcut.equals(n,a)&&Earcut.intersects(n,r,r.next,a)&&Earcut.locallyInside(n,a)&&Earcut.locallyInside(a,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(a.i/i),Earcut.removeNode(r),Earcut.removeNode(r.next),r=t=a),r=r.next}while(r!==t);return r},Earcut.splitEarcut=function(t,e,i,r,n,a){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Earcut.isValidDiagonal(s,o)){var h=Earcut.splitPolygon(s,o);return s=Earcut.filterPoints(s,s.next),h=Earcut.filterPoints(h,h.next),Earcut.earcutLinked(s,e,i,r,n,a),void Earcut.earcutLinked(h,e,i,r,n,a)}o=o.next}s=s.next}while(s!==t)},Earcut.eliminateHoles=function(t,e,i,r){var n,a,s,o,h,u=[];for(n=0,a=e.length;n<a;n++)s=e[n]*r,o=n<a-1?e[n+1]*r:t.length,(h=Earcut.linkedList(t,s,o,r,!1))===h.next&&(h.steiner=!0),u.push(Earcut.getLeftmost(h));for(u.sort(Earcut.compareX),n=0;n<u.length;n++)Earcut.eliminateHole(u[n],i),i=Earcut.filterPoints(i,i.next);return i},Earcut.compareX=function(t,e){return t.x-e.x},Earcut.eliminateHole=function(t,e){if(e=Earcut.findHoleBridge(t,e)){var i=Earcut.splitPolygon(e,t);Earcut.filterPoints(i,i.next)}},Earcut.findHoleBridge=function(t,e){var i,r=e,n=t.x,a=t.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===s)return i.prev;var h,u=i,l=i.x,c=i.y,_=1/0;for(r=i.next;r!==u;)n>=r.x&&r.x>=l&&n!==r.x&&Earcut.pointInTriangle(a<c?n:s,a,l,c,a<c?s:n,a,r.x,r.y)&&((h=Math.abs(a-r.y)/(n-r.x))<_||h===_&&r.x>i.x)&&Earcut.locallyInside(r,t)&&(i=r,_=h),r=r.next;return i},Earcut.indexCurve=function(t,e,i,r){var n=t;do{null===n.z&&(n.z=Earcut.zOrder(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,Earcut.sortLinked(n)},Earcut.sortLinked=function(t){var e,i,r,n,a,s,o,h,u=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,r=i,o=0,e=0;e<u&&(o++,r=r.nextZ);e++);for(h=u;o>0||h>0&&r;)0!==o&&(0===h||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,h--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;i=r}a.nextZ=null,u*=2}while(s>1);return t},Earcut.zOrder=function(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1},Earcut.getLeftmost=function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i},Earcut.pointInTriangle=function(t,e,i,r,n,a,s,o){return(n-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(r-o)-(i-s)*(e-o)>=0&&(i-s)*(a-o)-(n-s)*(r-o)>=0},Earcut.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Earcut.intersectsPolygon(t,e)&&Earcut.locallyInside(t,e)&&Earcut.locallyInside(e,t)&&Earcut.middleInside(t,e)},Earcut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},Earcut.equals=function(t,e){return t.x===e.x&&t.y===e.y},Earcut.intersects=function(t,e,i,r){return!!(Earcut.equals(t,e)&&Earcut.equals(i,r)||Earcut.equals(t,r)&&Earcut.equals(i,e))||Earcut.area(t,e,i)>0!=Earcut.area(t,e,r)>0&&Earcut.area(i,r,t)>0!=Earcut.area(i,r,e)>0},Earcut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Earcut.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},Earcut.locallyInside=function(t,e){return Earcut.area(t.prev,t,t.next)<0?Earcut.area(t,e,t.next)>=0&&Earcut.area(t,t.prev,e)>=0:Earcut.area(t,e,t.prev)<0||Earcut.area(t,t.next,e)<0},Earcut.middleInside=function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r},Earcut.splitPolygon=function(t,e){var i=new J(t.i,t.x,t.y),r=new J(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r},Earcut.insertNode=function(t,e,i,r){var n=new J(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n},Earcut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},Earcut.signedArea=function(t,e,i,r){for(var n=0,a=e,s=i-r;a<i;a+=r)n+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return n},Earcut}(),_t=function(){var t;function Path(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}n(Path,"laya.webgl.canvas.Path");var e=Path.prototype;return e.beginPath=function(e){this.paths.length=1,this._curPath=this.paths[0]=new t,this._curPath.convex=e},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new t,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(e,i){this._curPath?this._curPath.path.length>0&&(this._curPath=new t,this.paths.push(this._curPath)):(this._curPath=new t,this.paths.push(this._curPath));var r=this._curPath;r.path=e.slice(),r.convex=i},e.reset=function(){this.paths.length=0},Path.__init$=function(){t=function(){function renderPath(){this.path=[],this.loop=!1,this.convex=!1}return n(renderPath,""),renderPath}()},Path}(),ft=function(){function SubmitCMD(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new ht}n(SubmitCMD,"laya.webgl.submit.SubmitCMD");var t=SubmitCMD.prototype;return i.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=SubmitCMD.POOL;t[t._length++]=this}},t.clone=function(t,e,i){return null},SubmitCMD.create=function(t,e,i){var r=SubmitCMD.POOL._length?SubmitCMD.POOL[--SubmitCMD.POOL._length]:new SubmitCMD;return r.fun=e,r.args=t,r._this=i,r._ref=1,r._key.clear(),r},SubmitCMD.POOL=(SubmitCMD.POOL=[],SubmitCMD.POOL._length=0,SubmitCMD.POOL),SubmitCMD}(),dt=(function(){function MatirxArray(){}n(MatirxArray,"laya.webgl.utils.MatirxArray"),MatirxArray.ArrayMul=function(t,e,i){if(t)if(e)for(var r=NaN,n=NaN,a=NaN,s=NaN,o=0;o<4;o++)r=t[o],n=t[o+4],a=t[o+8],s=t[o+12],i[o]=r*e[0]+n*e[1]+a*e[2]+s*e[3],i[o+4]=r*e[4]+n*e[5]+a*e[6]+s*e[7],i[o+8]=r*e[8]+n*e[9]+a*e[10]+s*e[11],i[o+12]=r*e[12]+n*e[13]+a*e[14]+s*e[15];else MatirxArray.copyArray(t,i);else MatirxArray.copyArray(e,i)},MatirxArray.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]}}(),function(){function VertexArrayObject(){}return n(VertexArrayObject,"laya.webgl.VertexArrayObject"),VertexArrayObject}()(function(){var e={};function synthesizeGLError(i,r){var n;e[i]=!0,void 0!==r&&(n=r,t.console&&t.console.error&&t.console.error(n))}var i=function WebGLVertexArrayObjectOES(t){var e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(var i=0;i<this.attribs.length;i++){var r=new WebGLVertexArrayObjectOES.VertexAttrib(e);this.attribs[i]=r}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var r=function(i){var r=this;this.gl=i,function(t){var i=t.getError;t.getError=function(){do{(r=i.apply(t))!=t.NO_ERROR&&(e[r]=!0)}while(r!=t.NO_ERROR);for(var r in e)if(e[r])return delete e[r],parseInt(r);return t.NO_ERROR}}(i);var n=this.original={getParameter:i.getParameter,enableVertexAttribArray:i.enableVertexAttribArray,disableVertexAttribArray:i.disableVertexAttribArray,bindBuffer:i.bindBuffer,getVertexAttrib:i.getVertexAttrib,vertexAttribPointer:i.vertexAttribPointer};i.getParameter=function(t){return t==r.VERTEX_ARRAY_BINDING_OES?r.currentVertexArrayObject==r.defaultVertexArrayObject?null:r.currentVertexArrayObject:n.getParameter.apply(this,arguments)},i.enableVertexAttribArray=function(t){var e=r.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},i.disableVertexAttribArray=function(t){var e=r.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},i.bindBuffer=function(t,e){switch(t){case i.ARRAY_BUFFER:r.currentArrayBuffer=e;break;case i.ELEMENT_ARRAY_BUFFER:r.currentVertexArrayObject.elementArrayBuffer=e}return n.bindBuffer.apply(this,arguments)},i.getVertexAttrib=function(t,e){var a=r.currentVertexArrayObject.attribs[t];switch(e){case i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return a.buffer;case i.VERTEX_ATTRIB_ARRAY_ENABLED:return a.enabled;case i.VERTEX_ATTRIB_ARRAY_SIZE:return a.size;case i.VERTEX_ATTRIB_ARRAY_STRIDE:return a.stride;case i.VERTEX_ATTRIB_ARRAY_TYPE:return a.type;case i.VERTEX_ATTRIB_ARRAY_NORMALIZED:return a.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},i.vertexAttribPointer=function(t,e,i,a,s,o){var h=r.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,t);var u=h.attribs[t];return u.buffer=r.currentArrayBuffer,u.size=e,u.type=i,u.normalized=a,u.stride=s,u.offset=o,u.recache(),n.vertexAttribPointer.apply(this,arguments)},i.instrumentExtension&&i.instrumentExtension(this,"OES_vertex_array_object"),i.canvas&&i.canvas.addEventListener&&i.canvas.addEventListener("webglcontextrestored",function(){var e;e="OESVertexArrayObject emulation library context restored",t.console&&t.console.log&&t.console.log(e),r.reset_()},!0),this.reset_()};r.prototype.VERTEX_ARRAY_BINDING_OES=34229,r.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},r.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},r.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},r.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},r.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var n=this.currentVertexArrayObject;if(r!=n){r&&n.elementArrayBuffer==r.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer);for(var a=this.currentArrayBuffer,s=Math.max(r?r.maxAttrib:0,n.maxAttrib),o=0;o<=s;o++){var h=n.attribs[o],u=r?r.attribs[o]:null;if(r&&h.enabled==u.enabled||(h.enabled?i.enableVertexAttribArray.call(e,o):i.disableVertexAttribArray.call(e,o)),h.enabled){var l=!1;r&&h.buffer==u.buffer||(a!=h.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,h.buffer),a=h.buffer),l=!0),(l||h.cached!=u.cached)&&i.vertexAttribPointer.call(e,o,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=a&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else synthesizeGLError(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},t._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject))}},t._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new r(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e||null}}}()),function(){function CONST3D2D(){}return n(CONST3D2D,"laya.webgl.utils.CONST3D2D"),CONST3D2D.BYTES_PE=4,CONST3D2D.BYTES_PIDX=2,CONST3D2D.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],CONST3D2D.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],CONST3D2D._TMPARRAY=[],CONST3D2D._OFFSETX=0,CONST3D2D._OFFSETY=0,CONST3D2D}()),xt=function(t){function RenderSprite3D(t,e){RenderSprite3D.__super.call(this,t,e)}n(RenderSprite3D,"laya.webgl.utils.RenderSprite3D",v);var e=RenderSprite3D.prototype;return e.onCreate=function(t){switch(t){case 4:return void(this._fun=this._blend)}},e._mask=function(t,e,i,r){var n=this._next,a=t.mask,s=e;if(a){s.save();var o=s.globalCompositeOperation,h=new T;if(h.copyFrom(a.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),h.width>0&&h.height>0){var u=h.width,l=h.height,c=G.getRT(u,l);s.breakNextMerge(),s.pushRT(),s.addRenderObject(ft.create([s,c,u,l],laya.webgl.utils.RenderSprite3D.tmpTarget,this)),a.render(s,-h.x,-h.y),s.breakNextMerge(),s.popRT(),s.save(),s.clipRect(i+h.x-t.getStyle().pivotX,r+h.y-t.getStyle().pivotY,u,l),n._fun.call(n,t,s,i,r),s.restore(),o=s.globalCompositeOperation,s.addRenderObject(ft.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var _=w.create(1,0),f=L.INV_UV;s.drawTarget(c,i+h.x-t.getStyle().pivotX,r+h.y-t.getStyle().pivotY,u,l,p.TEMP.identity(),_,f,6),s.addRenderObject(ft.create([c],laya.webgl.utils.RenderSprite3D.recycleTarget,this)),s.addRenderObject(ft.create([o],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}s.restore()}else n._fun.call(n,t,e,i,r)},e._blend=function(t,e,i,r){var n=t._style,a=this._next;n.blendMode?(e.save(),e.globalCompositeOperation=n.blendMode,a._fun.call(a,t,e,i,r),e.restore()):a._fun.call(a,t,e,i,r)},RenderSprite3D.tmpTarget=function(t,e,i,r){e.start(),e.clear(0,0,0,0)},RenderSprite3D.recycleTarget=function(t){G.releaseRT(t)},RenderSprite3D.setBlendMode=function(t){var e=$.mainContext;q.targetFns[q.TOINT[t]](e)},r(RenderSprite3D,["tempUV",function(){return this.tempUV=new Array(8)}]),RenderSprite3D}(),pt=function(t){var e;function WebGLContext2D(){if(this._drawTriUseAbsMatrix=!1,this._id=++WebGLContext2D._COUNT,this._other=null,this._renderNextSubmitIndex=0,this._path=null,this._drawCount=1,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._clipInCache=!1,this._clipInfoID=0,this._curMat=null,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._save=null,this._targets=null,this._charSubmitCache=null,this._saveMark=null,this.sprite=null,this._drawTextureUseColor=!1,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this._colorFiler=null,this.drawTexAlign=!1,this._incache=!1,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,WebGLContext2D.__super.call(this),this._tmpMatrix=new p,this._drawTexToDrawTri_Vert=new Float32Array(8),this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]),this._tempUV=new Float32Array(8),this._width=99999999,this._height=99999999,this._submitKey=new ht,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=WebGLContext2D.MAXCLIPRECT,this._globalClipMatrix=new p(99999999,0,0,99999999,0,0),this._shader2D=new O,this.mOutPoint,WebGLContext2D._contextcount++,!WebGLContext2D.defTexture){var t=new Pt(2,2);t.setPixels(new Uint8Array(16)),t.lock=!0,WebGLContext2D.defTexture=new L(t)}this._lastTex=WebGLContext2D.defTexture,this.clear()}n(WebGLContext2D,"laya.webgl.canvas.WebGLContext2D",c);var o=WebGLContext2D.prototype;return o.clearBG=function(t,e,i,r){var n=$.mainContext;n.clearColor(t,e,i,r),n.clear(16384)},o._getSubmits=function(){return this._submits},o._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var i;for(t=0,i=this.meshlist.length;t<i;t++){this.meshlist[t].destroy()}this.meshlist.length=0,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}},o.destroy=function(){--WebGLContext2D._contextcount,this.sprite=null,this._releaseMem(),this._charSubmitCache.destroy(),this._targets&&this._targets.destroy(),this._targets=null,this._mesh.destroy()},o.clear=function(){this._submits||(this._other=e.DEFAULT,this._curMat=p.create(),this._charSubmitCache=new Y,this._mesh=St.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=gt.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=vt.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[ut.Create(this)],this._save.length=10,this._shader2D=new O),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=e.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=WebGLContext2D.MAXCLIPRECT,this._curSubmit=U.RENDERBASE,U.RENDERBASE._ref=16777215,U.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=P.DEFAULT;for(var t=0,i=this._submits._length;t<i;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},o.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new Ot(t,e,1,-1)),m._context==this&&($.mainContext.viewport(0,0,t,e),W.width=t,W.height=e)),0===t&&0===e&&this._releaseMem()},o.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b?this._lastMatScaleX:(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b,this._lastMatScaleX)},o.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d?this._lastMatScaleY:(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d,this._lastMatScaleY)},o.setFillColor=function(t){this._fillColor=t},o.getFillColor=function(){return this._fillColor},o.translate=function(t,e){0===t&&0===e||(B.save(this),this._curMat._bTransform?(k.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},o.save=function(){this._save[this._save._length++]=ut.Create(this)},o.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;i>=0;i--){var r=this._save[i];if(r.restore(this),r.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=U.RENDERBASE)}},o.fillText=function(t,e,i,r,n,a){this._fillText(t,null,e,i,r,n,null,0,null)},o._fillText=function(t,e,i,r,n,a,s,o,h,u){void 0===u&&(u=0),t?WebGLContext2D._textRender.filltext(this,t,i,r,n,a,s,o,h,u):e&&WebGLContext2D._textRender.fillWords(this,e,i,r,n,a,s,o)},o._fast_filltext=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=0),WebGLContext2D._textRender._fast_filltext(this,t,null,e,i,r,n,a,s,o,h)},o.fillWords=function(t,e,i,r,n){this._fillText(null,t,e,i,r,n,null,-1,null,0)},o.fillBorderWords=function(t,e,i,r,n,a,s){this._fillBorderText(null,t,e,i,r,n,a,s,null)},o.drawText=function(t,e,i,r,n,a){this._fillText(t,null,e,i,r,u.create(n).strColor,null,-1,a)},o.strokeWord=function(t,e,i,r,n,a,s){this._fillText(t,null,e,i,r,null,u.create(n).strColor,a||1,s)},o.fillBorderText=function(t,e,i,r,n,a,s,o){this._fillBorderText(t,null,e,i,r,u.create(n).strColor,u.create(a).strColor,s,o)},o._fillBorderText=function(t,e,i,r,n,a,s,o,h){this._fillText(t,e,i,r,n,a,s,o||1,h)},o._fillRect=function(t,e,i,r,n){var a=this._curSubmit,s=a&&2===a._key.submitType&&a._key.blendShader===this._nBlendType;this._mesh.vertNum+4>65535&&(this._mesh=St.getAMesh(),this.meshlist.push(this._mesh),s=!1),s&&(s=s&&this.isSameClipInfo(a)),this.transformQuad(t,e,i,r,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,L.NO_UV,n,!1),s||(a=this._curSubmit=Ct.create(this,this._mesh,w.create(1,0)),this._submits[this._submits._length++]=a,this._copyClipInfo(a,this._globalClipMatrix),a.shaderValue.textureHost=this._lastTex,a._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,a._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o.fillRect=function(t,e,i,r,n){var a=n?P.create(n):this._shader2D.fillStyle,s=this.mixRGBandAlpha(a.toInt());this._fillRect(t,e,i,r,s)},o.fillTexture=function(t,e,r,n,a,s,o,h){t._getSource()?this._fillTexture(t,t.width,t.height,t.uvrect,e,r,n,a,s,o.x,o.y):this.sprite&&i.systemTimer.callLater(this,this._repaintSprite)},o._fillTexture=function(t,e,i,r,n,a,s,o,h,u,l){var c=this._curSubmit;this._mesh.vertNum+4>65535&&(this._mesh=St.getAMesh(),this.meshlist.push(this._mesh));var _=!0,f=!0;switch(h){case"repeat":break;case"repeat-x":f=!1;break;case"repeat-y":_=!1;break;case"no-repeat":_=f=!1}var d=this._temp4Points,x=0,p=0,b=0,T=0,m=0,v=0;if(u<0?(b=n,x=-u%e/e):b=n+u,l<0?(T=a,p=-l%i/i):T=a+l,m=n+s,v=a+o,!_&&(m=Math.min(m,n+u+e)),!f&&(v=Math.min(v,a+l+i)),!(m<n||v<a||b>m||T>v)){var g=(m-n-u)/e,C=(v-a-l)/i;if(this.transformQuad(b,T,m-b,v-T,0,this._curMat,this._transedPoints),d[0]=x,d[1]=p,d[2]=g,d[3]=p,d[4]=g,d[5]=C,d[6]=x,d[7]=C,!this.clipedOff(this._transedPoints)){var S=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,d,S,!0);var y=w.create(1,0);y.defines.add(256),y.u_TexRange=r,c=this._curSubmit=Ct.create(this,this._mesh,y),this._submits[this._submits._length++]=c,this._copyClipInfo(c,this._globalClipMatrix),c.shaderValue.textureHost=t,c._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}},o.setColorFilter=function(t){D.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=U.RENDERBASE},o.drawTexture=function(t,e,i,r,n){this._drawTextureM(t,e,i,r,n,null,1,null)},o.drawTextures=function(t,e,r,n){if(t._getSource())for(var a=e.length/2,s=0,o=t.bitmap.id,h=0;h<a;h++)this._inner_drawTexture(t,o,e[s++]+r,e[s++]+n,0,0,null,null,1,!1);else this.sprite&&i.systemTimer.callLater(this,this._repaintSprite)},o._drawTextureAddSubmit=function(t,e){var i=null;i=Ct.create(this,this._mesh,w.create(1,0)),this._submits[this._submits._length++]=i,i.shaderValue.textureHost=e,i._key.other=t,i._renderType=10016,this._curSubmit=i},o._drawTextureM=function(t,e,r,n,a,s,o,h){return t._getSource()?this._inner_drawTexture(t,t.bitmap.id,e,r,n,a,s,h,o,!1):(this.sprite&&i.systemTimer.callLater(this,this._repaintSprite),!1)},o._drawRenderTexture=function(t,e,i,r,n,a,s,o){return this._inner_drawTexture(t,-1,e,i,r,n,a,o,1,!1)},o.submitDebugger=function(){this._submits[this._submits._length++]=ft.create([],function(){},this)},o._copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var r=t.shaderValue.clipMatPos;r[0]=e.tx,r[1]=e.ty,t.clipInfoID=this._clipInfoID,this._clipInCache&&(t.shaderValue.clipOff[0]=1)},o.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},o._useNewTex2DSubmit=function(t,e){this._mesh.vertNum+e>65535&&(this._mesh=St.getAMesh(),this.meshlist.push(this._mesh));var i=Ct.create(this,this._mesh,w.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)},o._drawTexRect=function(t,e,i,r,n){this.transformQuad(t,e,i,r,this._italicDeg,this._curMat,this._transedPoints);var a=this._transedPoints;a[0]=a[0]+.5|0,a[1]=a[1]+.5|0,a[2]=a[2]+.5|0,a[3]=a[3]+.5|0,a[4]=a[4]+.5|0,a[5]=a[5]+.5|0,a[6]=a[6]+.5|0,a[7]=a[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,n,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},o.drawCallOptimize=function(t){return this._charSubmitCache.enable(t,this),t},o._inner_drawTexture=function(t,e,i,r,n,a,s,o,h,u){var l=this._curSubmit._key;if(o=o||t._uv,4===l.submitType&&l.other===e){var c=this._drawTexToDrawTri_Vert;c[0]=i,c[1]=r,c[2]=i+n,c[3]=r,c[4]=i+n,c[5]=r+a,c[6]=i,c[7]=r+a,this._drawTriUseAbsMatrix=!0;var _=this._tempUV;return _[0]=o[0],_[1]=o[1],_[2]=o[2],_[3]=o[3],_[4]=o[4],_[5]=o[5],_[6]=o[6],_[7]=o[7],this.drawTriangles(t,0,0,c,_,this._drawTexToDrawTri_Index,s,h,null,null),this._drawTriUseAbsMatrix=!1,!0}var f=this._mesh,d=this._curSubmit,x=u?this._charSubmitCache.getPos():this._transedPoints;if(this.transformQuad(i,r,n||t.width,a||t.height,this._italicDeg,s||this._curMat,x),this.drawTexAlign){var p=Math.round;x[0]=p(x[0]),x[1]=p(x[1]),x[2]=p(x[2]),x[3]=p(x[3]),x[4]=p(x[4]),x[5]=p(x[5]),x[6]=p(x[6]),x[7]=p(x[7]),this.drawTexAlign=!1}var b=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(u)return this._charSubmitCache.add(this,t,e,x,o,b),!0;this._drawCount++;var T=e>=0&&2===l.submitType&&l.other===e;return T&&(T=T&&this.isSameClipInfo(d)),this._lastTex=t,f.vertNum+4>65535&&(f=this._mesh=St.getAMesh(),this.meshlist.push(f),T=!1),f.addQuad(x,o,b,!0),T||(this._submits[this._submits._length++]=this._curSubmit=d=Ct.create(this,f,w.create(1,0)),d.shaderValue.textureHost=t,d._key.other=e,this._copyClipInfo(d,this._globalClipMatrix)),d._numEle+=6,f.indexNum+=6,f.vertNum+=4,!0},o.transform4Points=function(t,e,i){var r=e.tx,n=e.ty,a=e.a,s=e.b,o=e.c,h=e.d,u=t[0],l=t[1],c=t[2],_=t[3],f=t[4],d=t[5],x=t[6],p=t[7];e._bTransform?(i[0]=u*a+l*o+r,i[1]=u*s+l*h+n,i[2]=c*a+_*o+r,i[3]=c*s+_*h+n,i[4]=f*a+d*o+r,i[5]=f*s+d*h+n,i[6]=x*a+p*o+r,i[7]=x*s+p*h+n):(i[0]=u+r,i[1]=l+n,i[2]=c+r,i[3]=_+n,i[4]=f+r,i[5]=d+n,i[6]=x+r,i[7]=p+n)},o.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},o.transformQuad=function(t,e,i,r,n,a,s){var o=0;0!=n&&(o=Math.tan(n*Math.PI/180)*r);var h=t+i,u=e+r,l=a.tx,c=a.ty,_=a.a,f=a.b,d=a.c,x=a.d,p=t+o,b=e,T=h+o,m=e,v=h,g=u,C=t,S=u;a._bTransform?(s[0]=p*_+b*d+l,s[1]=p*f+b*x+c,s[2]=T*_+m*d+l,s[3]=T*f+m*x+c,s[4]=v*_+g*d+l,s[5]=v*f+g*x+c,s[6]=C*_+S*d+l,s[7]=C*f+S*x+c):(s[0]=p+l,s[1]=b+c,s[2]=T+l,s[3]=m+c,s[4]=v+l,s[5]=g+c,s[6]=C+l,s[7]=S+c)},o.pushRT=function(){this.addRenderObject(ft.create(null,Ot.pushRT,this))},o.popRT=function(){this.addRenderObject(ft.create(null,Ot.popRT,this)),this.breakNextMerge()},o.useRT=function(t){this.addRenderObject(ft.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},o.RTRestore=function(t){this.addRenderObject(ft.create([t],function(t){t.restore()},this)),this.breakNextMerge()},o.breakNextMerge=function(){this._curSubmit=U.RENDERBASE},o._repaintSprite=function(){this.sprite&&this.sprite.repaint()},o.drawTextureWithTransform=function(t,e,i,r,n,a,s,o,h,u,l){var c=null,_=this._curMat;u&&(c=this.globalCompositeOperation,this.globalCompositeOperation=u);var f=this._colorFiler;if(l&&this.setColorFilter(l),!a)return this._drawTextureM(t,e+s,i+o,r,n,_,h,null),u&&(this.globalCompositeOperation=c),void(l&&this.setColorFilter(f));var d=this._tmpMatrix;d.a=a.a,d.b=a.b,d.c=a.c,d.d=a.d,d.tx=a.tx+s,d.ty=a.ty+o,d._bTransform=a._bTransform,a&&_._bTransform?(p.mul(d,_,d),(a=d)._bTransform=!0):a=d,this._drawTextureM(t,e,i,r,n,a,h,null),u&&(this.globalCompositeOperation=c),l&&this.setColorFilter(f)},o._flushToTarget=function(t,e){W.worldScissorTest=!1,$.mainContext.disable(3089);var i=W.worldAlpha,r=W.worldMatrix4,n=W.worldMatrix;W.worldShaderDefines;W.worldMatrix=p.EMPTY,W.restoreTempArray(),W.worldMatrix4=W.TEMPMAT4_ARRAY,W.worldAlpha=1,Dt.activeShader=null,e.start(),t._submits._length>0&&e.clear(0,0,0,0),t._curSubmit=U.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=U.RENDERBASE,Dt.activeShader=null,W.worldAlpha=i,W.worldMatrix4=r,W.worldMatrix=n},o.drawCanvas=function(t,e,i,r,n){if(t){var a,s=t.context;if(s._targets)s._submits._length>0&&(a=ft.create([s,s._targets],this._flushToTarget,this),this._submits[this._submits._length++]=a),this._drawRenderTexture(s._targets,e,i,r,n,null,1,Ot.flipyuv),this._curSubmit=U.RENDERBASE;else{var o=t;o.touches&&o.touches.forEach(function(t){t.touch()}),a=Rt.create(t,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=a,a._key.clear();var h=a._matrix;this._curMat.copyTo(h);var u=h.tx,l=h.ty;h.tx=h.ty=0,h.transformPoint(b.TEMP.setTo(e,i)),h.translate(b.TEMP.x+u,b.TEMP.y+l),p.mul(o.invMat,h,h),this._curSubmit=U.RENDERBASE}}},o.drawTarget=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=-1),this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);if(this._mesh.vertNum+4>65535&&(this._mesh=St.getAMesh(),this.meshlist.push(this._mesh)),this.transformQuad(e,i,r,n,0,a||this._curMat,this._transedPoints),!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,o||L.DEF_UV,4294967295,!0);var u=this._curSubmit=nt.create(this,this._mesh,s,t);return u.blendType=-1==h?this._nBlendType:h,this._copyClipInfo(u,this._globalClipMatrix),u._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=u,this._curSubmit=U.RENDERBASE,!0}return this._curSubmit=U.RENDERBASE,!1},o.drawTriangles=function(t,e,r,n,a,s,o,h,u,l){if(t._getSource()){this._drawCount++;var c=this._tmpMatrix,_=this._triangleMesh,f=null,d=!1;u&&(f=this._colorFiler,this._colorFiler=u,this._curSubmit=U.RENDERBASE,d=f!=u);var x=t.bitmap,b=this._curSubmit._key,T=4===b.submitType&&b.other===x.id&&b.blendShader==this._nBlendType;if(_.vertNum+n.length/2>65535&&(_=this._triangleMesh=vt.getAMesh(),this.meshlist.push(_),T=!1),!T){var m=this._curSubmit=Ct.create(this,_,w.create(1,0));m.shaderValue.textureHost=t,m._renderType=10016,m._key.submitType=4,m._key.other=x.id,this._copyClipInfo(m,this._globalClipMatrix),this._submits[this._submits._length++]=m}var v=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);this._drawTriUseAbsMatrix?_.addData(n,a,s,o,v):(o?(c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c.tx=o.tx+e,c.ty=o.ty+r):(c.a=1,c.b=0,c.c=0,c.d=1,c.tx=e,c.ty=r),p.mul(c,this._curMat,c),_.addData(n,a,s,c,v)),this._curSubmit._numEle+=s.length,d&&(this._colorFiler=f,this._curSubmit=U.RENDERBASE)}else this.sprite&&i.systemTimer.callLater(this,this._repaintSprite)},o.transform=function(t,e,i,r,n,a){k.save(this),p.mul(p.TEMP.setTo(t,e,i,r,n,a),this._curMat,this._curMat),this._curMat._checkTransform()},o._transformByMatrix=function(t,e,i){t.setTranslate(e,i),p.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},o.setTransformByMatrix=function(t){t.copyTo(this._curMat)},o.rotate=function(t){k.save(this),this._curMat.rotateEx(t)},o.scale=function(t,e){k.save(this),this._curMat.scaleEx(t,e)},o.clipRect=function(t,e,i,r){H.save(this),this._clipRect==WebGLContext2D.MAXCLIPRECT?this._clipRect=new T(t,e,i,r):(this._clipRect.width=i,this._clipRect.height=r,this._clipRect.x=t,this._clipRect.y=e),WebGLContext2D._clipID_Gen++,WebGLContext2D._clipID_Gen%=1e4,this._clipInfoID=WebGLContext2D._clipID_Gen;var n=this._globalClipMatrix,a=n.tx,s=n.ty,o=a+n.a,h=s+n.d;if(this._clipRect.width>=99999999?(n.a=n.d=99999999,n.b=n.c=n.tx=n.ty=0):(this._curMat._bTransform?(n.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,n.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,n.a=this._clipRect.width*this._curMat.a,n.b=this._clipRect.width*this._curMat.b,n.c=this._clipRect.height*this._curMat.c,n.d=this._clipRect.height*this._curMat.d):(n.tx=this._clipRect.x+this._curMat.tx,n.ty=this._clipRect.y+this._curMat.ty,n.a=this._clipRect.width,n.b=n.c=0,n.d=this._clipRect.height),this._incache&&(this._clipInCache=!0)),n.a>0&&n.d>0){var u=n.tx+n.a,l=n.ty+n.d;u<=a||l<=s||n.tx>=o||n.ty>=h?(n.a=-.1,n.d=-.1):(n.tx<a&&(n.a-=a-n.tx,n.tx=a),u>o&&(n.a-=u-o),n.ty<s&&(n.d-=s-n.ty,n.ty=s),l>h&&(n.d-=l-h),n.a<=0&&(n.a=-.1),n.d<=0&&(n.d=-.1))}},o.drawMesh=function(t,e,i,r,n,a,s,o,h){void 0===h&&(h=0)},o.addRenderObject=function(t){this._submits[this._submits._length++]=t},o.submitElement=function(t,e){m._context;var i=this._submits,r=i._length;e<0&&(e=i._length);for(var n=U.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==U.RENDERBASE?(U.preRender=n,t+=(n=i[t]).renderSubmit()):t++;return r},o.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),F.instance&&F.getInstance().reset(),this._curSubmit=U.RENDERBASE;for(var e=0,r=this.meshlist.length;e<r;e++){var n=this.meshlist[e];n.canReuse?n.releaseMesh():n.destroy()}if(this.meshlist.length=0,this._mesh=St.getAMesh(),this._pathMesh=gt.getAMesh(),this._triangleMesh=vt.getAMesh(),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&m._context==this){var a=i.textRender;a&&a.GC(!1)}return t},o.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=M.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},o.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},o.closePath=function(){this._path.closePath()},o.addPath=function(t,e,i,r,n){for(var a=0,s=0,o=t.length/2;s<o;s++){var h=t[a]+r,u=t[a+1]+n;t[a]=h,t[a+1]=u,a+=2}this._getPath().push(t,i)},o.fill=function(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n,a=this.mixRGBandAlpha(this.fillStyle.toInt()),s=0,o=0,h=e.paths.length;o<h;o++){var u=e.paths[o],l=u.path.length/2;if(!(l<3||3==l&&!u.convex)){var c=u.path.concat(),_=0,f=0,d=0,x=NaN,p=NaN;if(t._bTransform)for(_=0;_<l;_++)d=(f=_<<1)+1,x=c[f],p=c[d],c[f]=t.a*x+t.c*p+t.tx,c[d]=t.b*x+t.d*p+t.ty;else for(_=0;_<l;_++)d=(f=_<<1)+1,x=c[f],p=c[d],c[f]=x+t.tx,c[d]=p+t.ty;this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=s,s=0,this._pathMesh=gt.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));var b=this._pathMesh.vertNum;if(u.convex){var T=l-2;n=new Array(3*T);for(var m=0,v=0;v<T;v++)n[m++]=b,n[m++]=v+1+b,n[m++]=v+2+b}else if(n=ct.earcut(c,null,2),b>0)for(var g=0;g<n.length;g++)n[g]+=b;this._pathMesh.addVertAndIBToMesh(this,c,a,n),s+=n.length}}this._curSubmit._numEle+=s},o.addVGSubmit=function(t){var e=U.createShape(this,t,0,w.create(4,0));return e._key.submitType=3,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e},o.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,r=3===i._key.submitType&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i)),r||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var n=0,a=0,s=e.paths.length;a<s;a++){var o=e.paths[a];if(!(o.path.length<=0)){var h=[],u=[],l=2*o.path.length;if(!(l<2)){this._pathMesh.vertNum+l>65535&&(this._curSubmit._numEle+=n,n=0,this._pathMesh=gt.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),X.createLine2(o.path,h,this.lineWidth,this._pathMesh.vertNum,u,o.loop);var c=u.length/2,_=this._curMat,f=0,d=0,x=0,p=NaN,b=NaN;if(_._bTransform)for(f=0;f<c;f++)x=(d=f<<1)+1,p=u[d],b=u[x],u[d]=_.a*p+_.c*b+_.tx,u[x]=_.b*p+_.d*b+_.ty;else for(f=0;f<c;f++)x=(d=f<<1)+1,p=u[d],b=u[x],u[d]=p+_.tx,u[x]=b+_.ty;this._pathMesh.addVertAndIBToMesh(this,u,t,h),n+=h.length}}}this._curSubmit._numEle+=n}},o.moveTo=function(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)},o.lineTo=function(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))},o.arcTo=function(t,e,i,r,n){var a=0,s=0,o=0,h=this._path._lastOriX-t,u=this._path._lastOriY-e,l=Math.sqrt(h*h+u*u);if(!(l<=1e-6)){var c=h/l,_=u/l,f=i-t,d=r-e,x=f*f+d*d,p=Math.sqrt(x);if(!(p<=1e-6)){var b=f/p,T=d/p,m=c+b,v=_+T,g=Math.sqrt(m*m+v*v);if(!(g<=1e-6)){var C=m/g,S=v/g,y=Math.acos(C*c+S*_),R=Math.PI/2-y,E=(l=n/Math.tan(R))*c+t,A=l*_+e,L=Math.sqrt(l*l+n*n),M=t+C*L,D=e+S*L,w=0,B=0;if(c*T-_*b>=0){var G=2*R/WebGLContext2D.SEGNUM;w=Math.sin(G),B=Math.cos(G)}else G=2*-R/WebGLContext2D.SEGNUM,w=Math.sin(G),B=Math.cos(G);var I=this._path._lastOriX,W=this._path._lastOriY,P=E,O=A;(Math.abs(P-this._path._lastOriX)>.1||Math.abs(O-this._path._lastOriY)>.1)&&(s=P,o=O,I=P,W=O,this._path.addPoint(s,o));var N=E-M,F=A-D;for(a=0;a<WebGLContext2D.SEGNUM;a++){var V=N*B+F*w,U=-N*w+F*B;s=V+M,o=U+D,(Math.abs(I-s)>.1||Math.abs(W-o)>.1)&&(this._path.addPoint(s,o),I=s,W=o),N=V,F=U}}}}},o.arc=function(t,e,i,r,n,a,s){void 0===a&&(a=!1),void 0===s&&(s=!0);var o,h,u=0,l=0,c=0,_=0,f=0,d=0,x=0;if(l=n-r,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;l>0;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;l<0;)l+=2*Math.PI;var p=this.getMatScaleX(),b=this.getMatScaleY(),T=i*(p>b?p:b),m=2*Math.PI*T;o=l/(h=0|Math.max(m/10,10))/2,c=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),a&&(c=-c);var v=this._getPath();for(x=0;x<=h;x++)u=r+l*(x/h),_=Math.cos(u),d=e+Math.sin(u)*i,(f=t+_*i)==this._path._lastOriX&&d==this._path._lastOriY||v.addPoint(f,d);_=Math.cos(n),d=e+Math.sin(n)*i,(f=t+_*i)==this._path._lastOriX&&d==this._path._lastOriY||v.addPoint(f,d)},o.quadraticCurveTo=function(t,e,i,r){for(var n=s.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,r],30,2),a=0,o=n.length/2;a<o;a++)this.lineTo(n[2*a],n[2*a+1]);this.lineTo(i,r)},o.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new _t),this._other.path.rect(t,e,i,r)},o.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},o._mixRGBandAlpha=function(t,e){if(e>=1)return t;var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},o.strokeRect=function(t,e,i,r,n){if(this.lineWidth>0){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),s=this.lineWidth/2;this._fillRect(t-s,e-s,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e-s+r,i+this.lineWidth,this.lineWidth,a),this._fillRect(t-s,e+s,this.lineWidth,r-this.lineWidth,a),this._fillRect(t-s+i,e+s,this.lineWidth,r-this.lineWidth,a)}},o.clip=function(){},o.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},o._getPath=function(){return this._path||(this._path=new _t)},o._fillTexture_h=function(t,e,i,r,n,a,s,o){for(var h=a,u=Math.floor(o/r),l=o%r,c=0;c<u;c++)this._inner_drawTexture(t,e,h,s,r,n,this._curMat,i,1,!1),h+=r;if(l>0){var _=i[2]-i[0],f=i[0]+_*(l/r),d=WebGLContext2D.tmpuv1;d[0]=i[0],d[1]=i[1],d[2]=f,d[3]=i[3],d[4]=f,d[5]=i[5],d[6]=i[6],d[7]=i[7],this._inner_drawTexture(t,e,h,s,l,n,this._curMat,d,1,!1)}},o._fillTexture_v=function(t,e,i,r,n,a,s,o){for(var h=s,u=Math.floor(o/n),l=o%n,c=0;c<u;c++)this._inner_drawTexture(t,e,a,h,r,n,this._curMat,i,1,!1),h+=n;if(l>0){var _=i[7]-i[1],f=i[1]+_*(l/n),d=WebGLContext2D.tmpuv1;d[0]=i[0],d[1]=i[1],d[2]=i[2],d[3]=i[3],d[4]=i[4],d[5]=f,d[6]=i[6],d[7]=f,this._inner_drawTexture(t,e,a,h,r,l,this._curMat,d,1,!1)}},o.drawTextureWithSizeGrid=function(t,e,i,r,n,a,s,o){if(t._getSource()){e+=s,i+=o;var h=t.uv,u=t.bitmap._width,l=t.bitmap._height,c=a[0],_=a[3],f=c/l,d=_/u,x=a[1],p=a[2],b=x/u,T=p/l,m=a[4],v=!1;if(r==u&&(_=x=0),n==l&&(c=p=0),_+x>r){var g=r;v=!0,r=_+x,this.save(),this.clipRect(0+e,0+i,g,n)}var C=t.bitmap.id,S=this._curMat,y=this._tempUV,R=h[0],E=h[1],A=h[4],L=h[5],M=R,D=E,w=A,B=L;if(_&&c&&(w=R+d,B=E+f,y[0]=R,y[1]=E,y[2]=w,y[3]=E,y[4]=w,y[5]=B,y[6]=R,y[7]=B,this._inner_drawTexture(t,C,e,i,_,c,S,y,1,!1)),x&&c&&(M=A-b,D=E,w=A,B=E+f,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,this._inner_drawTexture(t,C,r-x+e,0+i,x,c,S,y,1,!1)),_&&p&&(M=R,D=L-T,w=R+d,B=L,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,this._inner_drawTexture(t,C,0+e,n-p+i,_,p,S,y,1,!1)),x&&p&&(M=A-b,D=L-T,w=A,B=L,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,this._inner_drawTexture(t,C,r-x+e,n-p+i,x,p,S,y,1,!1)),c&&(M=R+d,D=E,w=A-b,B=E+f,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,m?this._fillTexture_h(t,C,y,t.width-_-x,c,_+e,i,r-_-x):this._inner_drawTexture(t,C,_+e,i,r-_-x,c,S,y,1,!1)),p&&(M=R+d,D=L-T,w=A-b,B=L,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,m?this._fillTexture_h(t,C,y,t.width-_-x,p,_+e,n-p+i,r-_-x):this._inner_drawTexture(t,C,_+e,n-p+i,r-_-x,p,S,y,1,!1)),_&&(M=R,D=E+f,w=R+d,B=L-T,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,m?this._fillTexture_v(t,C,y,_,t.height-c-p,e,c+i,n-c-p):this._inner_drawTexture(t,C,e,c+i,_,n-c-p,S,y,1,!1)),x&&(M=A-b,D=E+f,w=A,B=L-T,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,m?this._fillTexture_v(t,C,y,x,t.height-c-p,r-x+e,c+i,n-c-p):this._inner_drawTexture(t,C,r-x+e,c+i,x,n-c-p,S,y,1,!1)),M=R+d,D=E+f,w=A-b,B=L-T,y[0]=M,y[1]=D,y[2]=w,y[3]=D,y[4]=w,y[5]=B,y[6]=M,y[7]=B,m){var G=WebGLContext2D.tmpUVRect;G[0]=M,G[1]=D,G[2]=w-M,G[3]=B-D,this._fillTexture(t,t.width-_-x,t.height-c-p,G,_+e,c+i,r-_-x,n-c-p,"repeat",0,0)}else this._inner_drawTexture(t,C,_+e,c+i,r-_-x,n-c-p,S,y,1,!1);v&&this.restore()}},a(0,o,"globalCompositeOperation",function(){return q.NAMES[this._nBlendType]},function(t){var e=q.TOINT[t];null==e||this._nBlendType===e||(D.save(this,65536,this,!0),this._curSubmit=U.RENDERBASE,this._nBlendType=e)}),a(0,o,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(D.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=P.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),a(0,o,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(D.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),a(0,o,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Ot(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),a(0,o,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(D.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=P.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),a(0,o,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),D.save(this,32768,this._other,!1),this._other.textAlign=t)}),a(0,o,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),D.save(this,256,this._other,!1),this._other.lineWidth=t)}),a(0,o,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),D.save(this,16384,this._other,!1),this._other.textBaseline=t)}),a(0,o,"font",null,function(t){this._other=this._other.make(),D.save(this,8,this._other,!1)}),a(0,o,"canvas",function(){return this._canvas}),WebGLContext2D.__init__=function(){e.DEFAULT=new e},WebGLContext2D.set2DRenderConfig=function(){var t=lt.instance;j.setBlend(t,!0),j.setBlendFunc(t,1,771),j.setDepthTest(t,!1),j.setCullFace(t,!1),j.setDepthMask(t,!0),j.setFrontFace(t,2305),m.isConchApp||t.viewport(0,0,W.width,W.height)},WebGLContext2D._SUBMITVBSIZE=32e3,WebGLContext2D._MAXSIZE=99999999,WebGLContext2D._MAXVERTNUM=65535,WebGLContext2D.MAXCLIPRECT=new T(0,0,99999999,99999999),WebGLContext2D._COUNT=0,WebGLContext2D.SEGNUM=32,WebGLContext2D._contextcount=0,WebGLContext2D._clipID_Gen=0,WebGLContext2D.defTexture=null,r(WebGLContext2D,["_textRender",function(){return this._textRender=new at},"tmpuv1",function(){return this.tmpuv1=[0,0,0,0,0,0,0,0]},"tmpUV",function(){return this.tmpUV=[0,0,0,0,0,0,0,0]},"tmpUVRect",function(){return this.tmpUVRect=[0,0,0,0]}]),WebGLContext2D.__init$=function(){e=function(){function ContextParams(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null}n(ContextParams,"");var t=ContextParams.prototype;return t.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null},t.make=function(){return this===ContextParams.DEFAULT?new ContextParams:this},ContextParams.DEFAULT=null,ContextParams}()},WebGLContext2D}(),bt=function(t){function PrimitiveSV(t){PrimitiveSV.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return n(PrimitiveSV,"laya.webgl.shader.d2.value.PrimitiveSV",w),PrimitiveSV}(),Tt=function(t){function SkinSV(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,SkinSV.__super.call(this,512,0);var e=8*dt.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*dt.BYTES_PE],this.color=[4,5126,!1,e,4*dt.BYTES_PE]}return n(SkinSV,"laya.webgl.shader.d2.skinAnishader.SkinSV",w),SkinSV}(),mt=function(t){function TextureSV(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),TextureSV.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return n(TextureSV,"laya.webgl.shader.d2.value.TextureSV",w),TextureSV.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+($.shaderHighPrecision?1024:0)},TextureSV}(),vt=function(t){function MeshTexture(){MeshTexture.__super.call(this,24,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}n(MeshTexture,"laya.webgl.utils.MeshTexture",I);var e=MeshTexture.prototype;return e.addData=function(t,e,i,r,n){var a=this._vb,s=this._ib,o=t.length>>1,h=a.needSize(24*o)>>2,u=a._floatArray32||a.getFloat32Array(),l=a._uint32Array,c=0,_=r.a,f=r.b,d=r.c,x=r.d,p=r.tx,b=r.ty,T=0;for(T=0;T<o;T++){var m=t[c],v=t[c+1];u[h]=m*_+v*d+p,u[h+1]=m*f+v*x+b,u[h+2]=e[c],u[h+3]=e[c+1],l[h+4]=n,l[h+5]=255,h+=6,c+=2}a.setNeedUpload();var g=this.vertNum,C=i.length,S=s.needSize(i.byteLength),y=s.getUint16Array(),R=S>>1;if(g>0){var E=R+C,A=0;for(T=R;T<E;T++,A++)y[T]=i[A]+g}else y.set(i,R);s.setNeedUpload(),this.vertNum+=o,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshTexture.getAMesh=function(){var t;return(t=laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new MeshTexture)._vb._resizeBuffer(1572864,!1),t},MeshTexture.const_stride=24,MeshTexture._POOL=[],r(MeshTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),MeshTexture}(),gt=function(t){function MeshVG(){MeshVG.__super.call(this,12,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}n(MeshVG,"laya.webgl.utils.MeshVG",I);var e=MeshVG.prototype;return e.addVertAndIBToMesh=function(t,e,i,r){for(var n=this._vb.needSize(e.length/2*12)>>2,a=this._vb._floatArray32||this._vb.getFloat32Array(),s=this._vb._uint32Array,o=0,h=e.length/2,u=0;u<h;u++)a[n++]=e[o],a[n++]=e[o+1],o+=2,s[n++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(r)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=r.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},MeshVG.getAMesh=function(){var t;return(t=laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new MeshVG)._vb._resizeBuffer(786432,!1),t},MeshVG.const_stride=12,MeshVG._POOL=[],r(MeshVG,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),MeshVG}(),Ct=(function(t){function MeshParticle2D(t){MeshParticle2D.__super.call(this,116,4*t*116,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo),this.createQuadIB(t),this._quadNum=t}n(MeshParticle2D,"laya.webgl.utils.MeshParticle2D",I);var e=MeshParticle2D.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(4*t*116,!1),this.createQuadIB(t)},e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshParticle2D._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._vb.deleteBuffer()},MeshParticle2D.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();return e.setMaxParticleNum(t),e}return new MeshParticle2D(t)},MeshParticle2D.const_stride=116,MeshParticle2D._POOL=[],r(MeshParticle2D,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}])}(),function(t){function SubmitTexture(t){void 0===t&&(t=1e4),SubmitTexture.__super.call(this,t)}n(SubmitTexture,"laya.webgl.submit.SubmitTexture",U);var e=SubmitTexture.prototype;return e.clone=function(t,e,i){var r=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture;return this._cloneInit(r,t,e,i),r},e.releaseRender=function(){--this._ref<1&&(SubmitTexture.POOL[SubmitTexture._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=$.mainContext;this._mesh.useMesh(i);var r=U.preRender,n=U.preRender._key;return 0===this._key.blendShader&&this._key.submitType===n.submitType&&this._key.blendShader===n.blendShader&&Dt.activeShader&&U.preRender.clipInfoID==this.clipInfoID&&r.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&Mt.NOOPTMASK)?Dt.activeShader.uploadTexture2D(e):(q.activeBlendFunction!==this._blendFn&&(j.setBlend(i,!0),this._blendFn(i),q.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),R.renderBatches++,R.trianglesFaces+=this._numEle/3,1},SubmitTexture.create=function(t,e,i){var r=SubmitTexture._poolSize?SubmitTexture.POOL[--SubmitTexture._poolSize]:new SubmitTexture(10016);r._mesh=e,r._key.clear(),r._key.submitType=2,r._ref=1,r._startIdx=e.indexNum*dt.BYTES_PIDX,r._numEle=0;var n=t._nBlendType;if(r._key.blendShader=n,r._blendFn=t._targets?q.targetFns[n]:q.fns[n],r.shaderValue=i,t._colorFiler){var a=t._colorFiler;i.defines.add(a.type),i.colorMat=a._mat,i.colorAlpha=a._alpha}return r},SubmitTexture._poolSize=0,SubmitTexture.POOL=[],SubmitTexture}()),St=function(t){function MeshQuadTexture(){MeshQuadTexture.__super.call(this,24,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=MeshQuadTexture._maxIB):(this.createQuadIB(MeshQuadTexture._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}n(MeshQuadTexture,"laya.webgl.utils.MeshQuadTexture",I);var e=MeshQuadTexture.prototype;return e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},e.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},e.addQuad=function(t,e,i,r){var n=this._vb,a=n._byteLength>>2;n.setByteLength(a+24<<2);var s=n._floatArray32||n.getFloat32Array(),o=n._uint32Array,h=a,u=r?255:0;s[h++]=t[0],s[h++]=t[1],s[h++]=e[0],s[h++]=e[1],o[h++]=i,o[h++]=u,s[h++]=t[2],s[h++]=t[3],s[h++]=e[2],s[h++]=e[3],o[h++]=i,o[h++]=u,s[h++]=t[4],s[h++]=t[5],s[h++]=e[4],s[h++]=e[5],o[h++]=i,o[h++]=u,s[h++]=t[6],s[h++]=t[7],s[h++]=e[6],s[h++]=e[7],o[h++]=i,o[h++]=u,n._upload=!0},MeshQuadTexture.getAMesh=function(){var t=null;return(t=laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new MeshQuadTexture)._vb._resizeBuffer(1572864,!1),t},MeshQuadTexture.const_stride=24,MeshQuadTexture._fixib=null,MeshQuadTexture._maxIB=16384,MeshQuadTexture._POOL=[],r(MeshQuadTexture,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),MeshQuadTexture}(),yt=function(t){function Buffer2D(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,Buffer2D.__super.call(this)}n(Buffer2D,"laya.webgl.utils.Buffer2D",K);var e=Buffer2D.prototype;return e.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},e.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},e._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),R.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,lt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),lt.instance.bufferSubData(this._bufferType,0,this._buffer)},e._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),R.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,lt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||i){var r=this._buffer.slice(e,i);lt.instance.bufferSubData(this._bufferType,t,r)}else lt.instance.bufferSubData(this._bufferType,t,this._buffer)},e._checkArrayUse=function(){},e._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},e._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},e._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)},e._resizeBuffer=function(t,e){var i=this._buffer;if(t<=i.byteLength)return this;var r=this._u8Array;if(e&&i&&i.byteLength>0){var n=new ArrayBuffer(t),a=r&&r.buffer==i?r:new Uint8Array(i);(r=this._u8Array=new Uint8Array(n)).set(a,0),i=this._buffer=n}else i=this._buffer=new ArrayBuffer(t),this._u8Array=null;return this._checkArrayUse(),this._upload=!0,this._bufferSize=i.byteLength,this},e.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},e.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);var i=new Uint16Array(this._buffer,this._byteLength,e);if(6==e)i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5];else if(e>=100)i.set(new Uint16Array(t.buffer,0,e));else for(var r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},e.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},e.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;var n,a;n=i*r,this._resizeBuffer(this._byteLength+n,!0),a=new e(this._buffer,this._byteLength);var s=0;for(s=0;s<i;s++)a[s]=t[s];this._byteLength+=n,this._checkArrayUse()},e.getBuffer=function(){return this._buffer},e.setNeedUpload=function(){this._upload=!0},e.getNeedUpload=function(){return this._upload},e.upload=function(){var t=this._bind_upload();return lt.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(K._bindedVertexBuffer=null),34963==this._bufferType&&(K._bindedIndexBuffer=null),Dt.activeShader=null,t},e.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=this._bind_subUpload();return lt.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(K._bindedVertexBuffer=null),34963==this._bufferType&&(K._bindedIndexBuffer=null),Dt.activeShader=null,r},e._disposeResource=function(){this._upload=!0,this._uploadSize=0},e.clear=function(){this._byteLength=0,this._upload=!0},a(0,e,"bufferLength",function(){return this._buffer.byteLength}),a(0,e,"byteLength",null,function(t){this.setByteLength(t)}),Buffer2D.__int__=function(t){},Buffer2D.FLOAT32=4,Buffer2D.SHORT=2,Buffer2D}(),Rt=function(t){function SubmitCanvas(){this._matrix=new p,this._matrix4=dt.defaultMatrix4.concat(),SubmitCanvas.__super.call(this,1e4),this.shaderValue=new w(0,0)}n(SubmitCanvas,"laya.webgl.submit.SubmitCanvas",U);var e=SubmitCanvas.prototype;return e.renderSubmit=function(){var t=W.worldAlpha,e=W.worldMatrix4,i=W.worldMatrix,r=W.worldFilters,n=W.worldShaderDefines,a=this.shaderValue,s=this._matrix,o=this._matrix4,h=p.TEMP;return p.mul(s,i,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,W.worldMatrix=h.clone(),W.worldMatrix4=o,W.worldAlpha=W.worldAlpha*a.alpha,a.filters&&a.filters.length&&(W.worldFilters=a.filters,W.worldShaderDefines=a.defines),this.canv.flushsubmit(),W.worldAlpha=t,W.worldMatrix4=e,W.worldMatrix.destroy(),W.worldMatrix=i,W.worldFilters=r,W.worldShaderDefines=n,1},e.releaseRender=function(){if(--this._ref<1){var t=SubmitCanvas.POOL;this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,i){return null},e.getRenderType=function(){return 10003},SubmitCanvas.create=function(t,e,i){var r=SubmitCanvas.POOL._length?SubmitCanvas.POOL[--SubmitCanvas.POOL._length]:new SubmitCanvas;r.canv=t,r._ref=1,r._numEle=0;var n=r.shaderValue;return n.alpha=e,n.defines.setValue(0),i&&i.length&&n.setFilters(i),r},SubmitCanvas.POOL=(SubmitCanvas.POOL=[],SubmitCanvas.POOL._length=0,SubmitCanvas.POOL),SubmitCanvas}(),Et=function(t){function BufferState2D(){BufferState2D.__super.call(this)}return n(BufferState2D,"laya.webgl.BufferState2D",Q),BufferState2D}(),At=function(i){function CharRender_Canvas(i,r,n,a,s){this.ctx=null,this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,this.maxTexW=0,this.maxTexH=0,this.scaleFontSize=!0,this.showDbgInfo=!1,this.supportImageData=!0,CharRender_Canvas.__super.call(this),void 0===n&&(n=!0),void 0===a&&(a=!0),void 0===s&&(s=!1),this.maxTexW=i,this.maxTexH=r,this.scaleFontSize=n,this.supportImageData=a,this.showDbgInfo=s,CharRender_Canvas.canvas||(CharRender_Canvas.canvas=t.document.createElement("canvas"),CharRender_Canvas.canvas.width=1024,CharRender_Canvas.canvas.height=512,CharRender_Canvas.canvas.style.left="-10000px",CharRender_Canvas.canvas.style.position="absolute",e.body.appendChild(CharRender_Canvas.canvas),this.ctx=CharRender_Canvas.canvas.getContext("2d"))}n(CharRender_Canvas,"laya.webgl.resource.CharRender_Canvas",z);var r=CharRender_Canvas.prototype;return r.getWidth=function(t,e){return this.ctx?(this.ctx._lastFont!=t&&(this.ctx.font=t,this.ctx._lastFont=t),this.ctx.measureText(e).width):0},r.scale=function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(this.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)},r.getCharBmp=function(t,e,i,r,n,a,s,o,h,u,l){if(!this.supportImageData)return this.getCharCanvas(t,e,i,r,n,a,s,o,h,u);var c=this.ctx;c.font!=e&&(c.font=e,c._lastFont=e),a.width=c.measureText(t).width;var _=a.width*this.lastScaleX,f=a.height*this.lastScaleY;_+=(s+h)*this.lastScaleX,f+=(o+u)*this.lastScaleY,_=Math.ceil(_),f=Math.ceil(f);var d=(_=Math.min(_,laya.webgl.resource.CharRender_Canvas.canvas.width))+2*i+1,x=(f=Math.min(f,laya.webgl.resource.CharRender_Canvas.canvas.height))+2*i+1;l&&(d=Math.max(d,l[0]+l[2]+1),x=Math.max(x,l[1]+l[3]+1)),c.clearRect(0,0,d,x),c.save(),c.textBaseline="top",i>0&&(c.strokeStyle=n,c.lineWidth=i,c.strokeText(t,s,o)),c.fillStyle=r,c.fillText(t,s,o),this.showDbgInfo&&(c.strokeStyle="#ff0000",c.strokeRect(0,0,_,f),c.strokeStyle="#00ff00",c.strokeRect(s,o,a.width,a.height)),l&&-1==l[2]&&(l[2]=Math.ceil((a.width+2*i)*this.lastScaleX));var p=l?c.getImageData(l[0],l[1],l[2],l[3]):c.getImageData(0,0,_,f);return c.restore(),a.bmpWidth=p.width,a.bmpHeight=p.height,p},r.getCharCanvas=function(t,e,i,r,n,a,s,o,h,u){var l=this.ctx;l.font!=e&&(l.font=e,l._lastFont=e),a.width=l.measureText(t).width;var c=a.width*this.lastScaleX,_=a.height*this.lastScaleY;return c+=(s+h)*this.lastScaleX,_+=(o+u)*this.lastScaleY+1,c=Math.min(c,this.maxTexW),_=Math.min(_,this.maxTexH),CharRender_Canvas.canvas.width=Math.min(c+1,this.maxTexW),CharRender_Canvas.canvas.height=Math.min(_+1,this.maxTexH),l.font=e,l.clearRect(0,0,c+1+i,_+1+i),l.setTransform(1,0,0,1,0,0),l.save(),this.scaleFontSize&&l.scale(this.lastScaleX,this.lastScaleY),l.translate(s,o),l.textAlign="left",l.textBaseline="top",i>0?(l.strokeStyle=n,l.fillStyle=r,l.lineWidth=i,l.fillAndStrokeText?l.fillAndStrokeText(t,0,0):(l.strokeText(t,0,0),l.fillText(t,0,0))):(l.fillStyle=r,l.fillText(t,0,0)),this.showDbgInfo&&(l.strokeStyle="#ff0000",l.strokeRect(0,0,c,_),l.strokeStyle="#00ff00",l.strokeRect(0,0,a.width,a.height)),l.restore(),a.bmpWidth=CharRender_Canvas.canvas.width,a.bmpHeight=CharRender_Canvas.canvas.height,CharRender_Canvas.canvas},a(0,r,"canvasWidth",function(){return CharRender_Canvas.canvas.width},function(t){CharRender_Canvas.canvas.width!=t&&(CharRender_Canvas.canvas.width=t,t>2048&&console.warn("画文字设置的宽度太大，超过2048了"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))}),CharRender_Canvas.canvas=null,CharRender_Canvas}(),Lt=function(e){function CharRender_Native(){this.lastFont="",CharRender_Native.__super.call(this)}n(CharRender_Native,"laya.webgl.resource.CharRender_Native",z);var i=CharRender_Native.prototype;return i.getWidth=function(e,i){return t.conchTextCanvas?(t.conchTextCanvas.font=e,this.lastFont=e,t.conchTextCanvas.measureText(i).width):0},i.scale=function(t,e){},i.getCharBmp=function(e,i,r,n,a,s,o,h,l,c,_){if(!t.conchTextCanvas)return null;t.conchTextCanvas.font=i,this.lastFont=i;s.width=t.conchTextCanvas.measureText(e).width,s.height;var f=u.create(a).numColor,d=u.create(n).numColor,x=t.conchTextCanvas.getTextBitmapData(e,d,r>2?2:r,f);return s.bmpWidth=x.width,s.bmpHeight=x.height,x},CharRender_Native}(),Mt=function(t){function ShaderDefines2D(){ShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap)}return n(ShaderDefines2D,"laya.webgl.shader.d2.ShaderDefines2D",it),ShaderDefines2D.__init__=function(){ShaderDefines2D.reg("TEXTURE2D",1),ShaderDefines2D.reg("PRIMITIVE",4),ShaderDefines2D.reg("GLOW_FILTER",8),ShaderDefines2D.reg("BLUR_FILTER",16),ShaderDefines2D.reg("COLOR_FILTER",32),ShaderDefines2D.reg("COLOR_ADD",64),ShaderDefines2D.reg("WORLDMAT",128),ShaderDefines2D.reg("FILLTEXTURE",256),ShaderDefines2D.reg("FSHIGHPRECISION",1024),ShaderDefines2D.reg("MVP3D",2048)},ShaderDefines2D.reg=function(t,e){it._reg(t,e,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name)},ShaderDefines2D.toText=function(t,e,i){return it._toText(t,e,i)},ShaderDefines2D.toInt=function(t){return it._toInt(t,ShaderDefines2D.__name2int)},ShaderDefines2D.TEXTURE2D=1,ShaderDefines2D.PRIMITIVE=4,ShaderDefines2D.FILTERGLOW=8,ShaderDefines2D.FILTERBLUR=16,ShaderDefines2D.FILTERCOLOR=32,ShaderDefines2D.COLORADD=64,ShaderDefines2D.WORLDMAT=128,ShaderDefines2D.FILLTEXTURE=256,ShaderDefines2D.SKINMESH=512,ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=1024,ShaderDefines2D.MVP3D=2048,ShaderDefines2D.NOOPTMASK=312,ShaderDefines2D.__name2int={},ShaderDefines2D.__int2name=[],ShaderDefines2D.__int2nameMap=[],ShaderDefines2D}(),Dt=function(t){function BaseShader(){BaseShader.__super.call(this)}return n(BaseShader,"laya.webgl.shader.BaseShader",g),BaseShader.activeShader=null,BaseShader.bindShader=null,BaseShader}(),wt=function(t){function TextTexture(t,e){this._source=null,this._texW=0,this._texH=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.bitmap={id:0,_glTexture:null},this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=0,this.ri=null,TextTexture.__super.call(this),this._texW=t||at.atlasWidth,this._texH=e||at.atlasWidth,this.bitmap.id=this.id,this.lock=!0}n(TextTexture,"laya.webgl.text.TextTexture",g);var e=TextTexture.prototype;return e.recreateResource=function(){if(!this._source){var t=m.isConchApp?lt.instance.getDefaultCommandEncoder():$.mainContext,e=this._source=t.createTexture();this.bitmap._glTexture=e,j.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),at.debugUV&&this.fillWhite()}},e.addChar=function(t,e,i,r){if(at.isWan1Wan)return this.addCharCanvas(t,e,i,r);!this._source&&this.recreateResource();var n=m.isConchApp?lt.instance.getDefaultCommandEncoder():$.mainContext;j.bindTexture(n,3553,this._source),!m.isConchApp&&n.pixelStorei(37441,!0);var a=t.data;t.data instanceof Uint8ClampedArray&&(a=new Uint8Array(a.buffer)),n.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,a),!m.isConchApp&&n.pixelStorei(37441,!1);var s=NaN,o=NaN,h=NaN,u=NaN;return m.isConchApp?(s=e/this._texW,o=i/this._texH,h=(e+t.width)/this._texW,u=(i+t.height)/this._texH):(s=(e+1)/this._texW,o=i/this._texH,h=(e+t.width-1)/this._texW,u=(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=s,r[1]=o,r[2]=h,r[3]=o,r[4]=h,r[5]=u,r[6]=s,r[7]=u,r},e.addCharCanvas=function(t,e,i,r){!this._source&&this.recreateResource();var n=m.isConchApp?lt.instance.getDefaultCommandEncoder():$.mainContext;j.bindTexture(n,3553,this._source),!m.isConchApp&&n.pixelStorei(37441,!0),n.texSubImage2D(3553,0,e,i,6408,5121,t),!m.isConchApp&&n.pixelStorei(37441,!1);var a=NaN,s=NaN,o=NaN,h=NaN;return m.isConchApp?(a=e/this._texW,s=i/this._texH,o=(e+t.width)/this._texW,h=(i+t.height)/this._texH):(a=(e+1)/this._texW,s=(i+1)/this._texH,o=(e+t.width-1)/this._texW,h=(i+t.height-1)/this._texH),(r=r||new Array(8))[0]=a,r[1]=s,r[2]=o,r[3]=s,r[4]=o,r[5]=h,r[6]=a,r[7]=h,r},e.fillWhite=function(){!this._source&&this.recreateResource();var t=m.isConchApp?lt.instance.getDefaultCommandEncoder():$.mainContext,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)},e.discard=function(){this._texW==at.atlasWidth&&this._texH==at.atlasWidth?(this.genID++,TextTexture.poolLen>=TextTexture.pool.length&&(TextTexture.pool=TextTexture.pool.concat(new Array(10))),this._discardTm=i.stage.getFrameTm(),TextTexture.pool[TextTexture.poolLen++]=this):this.destroy()},e.destroy=function(){console.log("destroy TextTexture"),this.__destroyed=!0;var t=m.isConchApp?lt.instance.getDefaultCommandEncoder():$.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e.touchRect=function(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var i=at.atlasWidth*at.atlasWidth,r=rt.atlasGridW*rt.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/rt.atlasGridW)*Math.ceil(t.bmpHeight/rt.atlasGridW)/(i/r)},e._getSource=function(){return this._source},e.drawOnScreen=function(t,e){},a(0,e,"texture",function(){return this}),TextTexture.getTextTexture=function(t,e){if(t!=at.atlasWidth||t!=at.atlasWidth)return new TextTexture(t,e);if(TextTexture.poolLen>0){var i=TextTexture.pool[--TextTexture.poolLen];return TextTexture.poolLen>0&&TextTexture.clean(),i}return new TextTexture(t,e)},TextTexture.clean=function(){var t=i.stage.getFrameTm();if(0===TextTexture.cleanTm&&(TextTexture.cleanTm=t),t-TextTexture.cleanTm>=at.checkCleanTextureDt){for(var e=0;e<TextTexture.poolLen;e++){var r=TextTexture.pool[e];t-r._discardTm>=at.destroyUnusedTextureDt&&(r.destroy(),TextTexture.pool[e]=TextTexture.pool[TextTexture.poolLen-1],TextTexture.poolLen--,e--)}TextTexture.cleanTm=t}},TextTexture.poolLen=0,TextTexture.cleanTm=0,r(TextTexture,["pool",function(){return this.pool=new Array(10)}]),TextTexture}(),Bt=function(t){function VertexBuffer2D(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,VertexBuffer2D.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}n(VertexBuffer2D,"laya.webgl.utils.VertexBuffer2D",yt);var e=VertexBuffer2D.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){lt.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return K._bindedVertexBuffer!==this._glBuffer&&(lt.instance.bindBuffer(34962,this._glBuffer),K._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},a(0,e,"vertexStride",function(){return this._vertexStride}),VertexBuffer2D.create=function(t,e){return void 0===e&&(e=35048),new VertexBuffer2D(t,e)},VertexBuffer2D}(),Gt=function(t){function IndexBuffer2D(t){this._uint16Array=null,void 0===t&&(t=35044),IndexBuffer2D.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}n(IndexBuffer2D,"laya.webgl.utils.IndexBuffer2D",yt);var e=IndexBuffer2D.prototype;return e._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},e.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},e._bindForVAO=function(){lt.instance.bindBuffer(34963,this._glBuffer)},e.bind=function(){return K._bindedIndexBuffer!==this._glBuffer&&(lt.instance.bindBuffer(34963,this._glBuffer),K._bindedIndexBuffer=this._glBuffer,!0)},e.destory=function(){this._uint16Array=null,this._buffer=null},e.disposeResource=function(){this._disposeResource()},IndexBuffer2D.create=function(t){return void 0===t&&(t=35044),new IndexBuffer2D(t)},IndexBuffer2D}(),It=function(t){function BaseTexture(t,e){BaseTexture.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=lt.instance.createTexture()}n(BaseTexture,"laya.webgl.resource.BaseTexture",o);var e=BaseTexture.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!j._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=j._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!j._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=j._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!j._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=j._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=lt.instance;switch(j.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var i=lt.instance;if(j.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){var e=j._extTextureFilterAnisotropic;if(e&&!h.onLimixiu){t=Math.max(t,1);var i=lt.instance;j.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},e._disposeResource=function(){this._glTexture&&(lt.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)&&lt.instance.generateMipmap(this._glTextureType)},a(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),a(0,e,"mipmap",function(){return this._mipmap}),a(0,e,"format",function(){return this._format}),a(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),a(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),a(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),a(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),BaseTexture.WARPMODE_REPEAT=0,BaseTexture.WARPMODE_CLAMP=1,BaseTexture.FILTERMODE_POINT=0,BaseTexture.FILTERMODE_BILINEAR=1,BaseTexture.FILTERMODE_TRILINEAR=2,BaseTexture.FORMAT_R8G8B8=0,BaseTexture.FORMAT_R8G8B8A8=1,BaseTexture.FORMAT_ALPHA8=2,BaseTexture.FORMAT_DXT1=3,BaseTexture.FORMAT_DXT5=4,BaseTexture.FORMAT_ETC1RGB=5,BaseTexture.FORMAT_PVRTCRGB_2BPPV=9,BaseTexture.FORMAT_PVRTCRGBA_2BPPV=10,BaseTexture.FORMAT_PVRTCRGB_4BPPV=11,BaseTexture.FORMAT_PVRTCRGBA_4BPPV=12,BaseTexture.FORMAT_DEPTH_16=0,BaseTexture.FORMAT_STENCIL_8=1,BaseTexture.FORMAT_DEPTHSTENCIL_16_8=2,BaseTexture.FORMAT_DEPTHSTENCIL_NONE=3,BaseTexture}(),Wt=function(t){function Shader(t,e,i,r,n){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},Shader.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=n,this._id=++Shader._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(Shader.sharders[i]=this),this.recreateResource(),this.lock=!0}n(Shader,"laya.webgl.shader.Shader",Dt);var e=Shader.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){$.mainContext.deleteShader(this._vshader),$.mainContext.deleteShader(this._pshader),$.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=et.preGetParams(this._vs,this._ps));var e=$.mainContext;this._program=e.createProgram(),this._vshader=Shader._createShader(e,this._vs,35633),this._pshader=Shader._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var i,r,n=0,a=this._attribInfo?this._attribInfo.length:0;for(n=0;n<a;n+=2)e.bindAttribLocation(this._program,this._attribInfo[n+1],this._attribInfo[n]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var s=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(n=0;n<s;n++){var o=this.customCompile?t.uniforms[n]:e.getActiveUniform(this._program,n);(i={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")>0&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(n=0,r=this._params.length;n<r;n++)switch((i=this._params[n]).indexOfParams=n,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,this._paramsMap[i.name]=i,i._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?($.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?($.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return $.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?($.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?($.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return $.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?($.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return $.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?($.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return $.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return $.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return $.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return $.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?($.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return $.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?($.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return $.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?($.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return $.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?($.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return $.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=$.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),j.activeTexture(i,33984+this._curActTexIndex),j.bindTexture(i,3553,e),this._curActTexIndex++,1):(j.activeTexture(i,33984+r[0]),j.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=$.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),j.activeTexture(i,33984+this._curActTexIndex),j.bindTexture(i,34067,e),this._curActTexIndex++,1):(j.activeTexture(i,33984+r[0]),j.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){j.useProgram($.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){var e=j;e._activeTextures[0]!==t&&(e.bindTexture($.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){Dt.activeShader=Dt.bindShader=this;var i=$.mainContext;j.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var r,n,a=e.length,s=0,o=0;o<a;o++)null!==(n=t[(r=e[o]).name])&&(s+=r.fun.call(this,r,n));R.shaderCall+=s},e.uploadArray=function(t,e,i){Dt.activeShader=this,Dt.bindShader=this,j.useProgram($.mainContext,this._program);this._params;for(var r,n,a=0,s=e-2;s>=0;s-=2)(n=this._paramsMap[t[s]])&&null!=(r=t[s+1])&&(i&&i[n.name]&&i[n.name].bind(),a+=n.fun.call(this,n,r));R.shaderCall+=a},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},Shader.getShader=function(t){return Shader.sharders[t]},Shader.create=function(t,e,i,r,n){return new Shader(t,e,i,r,n)},Shader.withCompile=function(t,e,i,r){if(i&&Shader.sharders[i])return Shader.sharders[i];var n=Shader._preCompileShader[2e-4*t];if(!n)throw new Error("withCompile shader err!"+t);return n.createShader(e,i,r,null)},Shader.withCompile2D=function(t,e,i,r,n,a){if(r&&Shader.sharders[r])return Shader.sharders[r];var s=Shader._preCompileShader[2e-4*t+e];if(!s)throw new Error("withCompile shader err!"+t+" "+e);return s.createShader(i,r,n,a)},Shader.addInclude=function(t,e){et.addInclude(t,e)},Shader.preCompile=function(t,e,i,r){var n=2e-4*t;Shader._preCompileShader[n]=new et(e,i,r)},Shader.preCompile2D=function(t,e,i,r,n){var a=2e-4*t+e;Shader._preCompileShader[a]=new et(i,r,n)},Shader._createShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,35713)?r:(console.log(t.getShaderInfoLog(r)),null)},Shader._count=0,Shader._preCompileShader={},Shader.SHADERNAME2ID=2e-4,Shader.sharders=new Array(32),r(Shader,["nameKey",function(){return this.nameKey=new E}]),Shader}(),Pt=function(t){function Texture2D(t,e,i,r,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=!0),void 0===n&&(n=!1),Texture2D.__super.call(this,i,r),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=n,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._mipmap){this._mipmapCount=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(2))+1);for(var a=0;a<this._mipmapCount;a++)this._setPixels(null,a,Math.max(t>>a,1),Math.max(e>>a,1));this._setGPUMemory(t*e*4*(1+1/3))}else this._mipmapCount=1,this._setGPUMemory(t*e*4)}n(Texture2D,"laya.webgl.resource.Texture2D",It);var e=Texture2D.prototype;return e._getFormatByteCount=function(){switch(this._format){case 0:return 3;case 1:return 4;case 2:return 1;default:throw"Texture2D: unknown format."}},e._setPixels=function(t,e,i,r){var n=lt.instance,a=this._glTextureType,s=this._getGLFormat();j.bindTexture(n,a,this._glTexture),0===this.format?(n.pixelStorei(3317,1),n.texImage2D(a,e,s,i,r,0,s,5121,t),n.pixelStorei(3317,4)):n.texImage2D(a,e,s,i,r,0,s,5121,t)},e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case 3:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var r=1;if(131072&e[2]){if(r=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var n=e[4],a=e[3];this._width=n,this._height=a;var s=e[1]+4;this._upLoadCompressedTexImage2D(t,n,a,r,s,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13);switch(i[4]){case j._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format."}var r=i[11],n=i[6],a=i[7];this._width=n,this._height=a;var s=64+i[12];this._upLoadCompressedTexImage2D(t,n,a,r,s,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";switch(e[2]){case 0:this._format=9;break;case 2:this._format=11;break;case 1:this._format=10;break;case 3:this._format=12;break;default:throw"Texture2D:unknown PVR format."}var i=e[11],r=e[7],n=e[6];this._width=r,this._height=n;var a=e[12]+52;this._upLoadCompressedTexImage2D(t,r,n,i,a,0)},e._upLoadCompressedTexImage2D=function(t,e,i,r,n,a){var s=lt.instance,o=this._glTextureType;j.bindTexture(s,o,this._glTexture);for(var h=this._getGLFormat(),u=n,l=0;l<r;l++){u+=a;var c=this._calcualatesCompressedDataSize(this._format,e,i),_=new Uint8Array(t,u,c);s.compressedTexImage2D(o,l,h,e,i,0,_),e=Math.max(e>>1,1),i=Math.max(i>>1,1),u+=c}var f=u;this._setGPUMemory(f),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,r=t.height;this._width=i,this._height=r,this._isPot(i)&&this._isPot(r)||(this._mipmap=!1),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var n=lt.instance;j.bindTexture(n,this._glTextureType,this._glTexture);var a=this._getGLFormat();m.isConchApp?t instanceof laya.resource.HTMLCanvas?n.texImage2D(this._glTextureType,0,6408,6408,5121,t):(t.setPremultiplyAlpha(e),n.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&n.pixelStorei(37441,!0),n.texImage2D(this._glTextureType,0,a,a,5121,t),e&&n.pixelStorei(37441,!1)),this._mipmap?(n.generateMipmap(this._glTextureType),this._setGPUMemory(i*r*4*(1+1/3))):this._setGPUMemory(i*r*4),this._canRead&&(m.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,r)):(h.canvas.size(i,r),h.canvas.clear(),h.context.drawImage(t,0,0,i,r),this._pixels=new Uint8Array(h.context.getImageData(0,0,i,r).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=Math.max(this._width>>e,1),r=Math.max(this._height>>e,1),n=i*r*this._getFormatByteCount();if(t.length<n)throw"Texture2D:pixels length should at least "+n+".";this._setPixels(t,e,i,r),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setSubPixels=function(t,e,i,r,n,a){if(void 0===a&&(a=0),!n)throw"Texture2D:pixels can't be null.";var s=lt.instance,o=this._glTextureType;j.bindTexture(s,o,this._glTexture);var h=this._getGLFormat();0===this._format?(s.pixelStorei(3317,1),s.texSubImage2D(o,a,t,e,i,r,h,5121,n),s.pixelStorei(3317,4)):s.texSubImage2D(o,a,t,e,i,r,h,5121,n),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},a(0,e,"mipmapCount",function(){return this._mipmapCount}),a(0,e,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture}),Texture2D.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,Texture2D.grayTexture=new Texture2D(1,1,0,!1,!1),Texture2D.grayTexture.setPixels(t),Texture2D.grayTexture.lock=!0},Texture2D._parse=function(t,e,i){var r=i?new Texture2D(i[0],i[1],i[2],i[3],i[4]):new Texture2D(0,0);switch(e&&(r.wrapModeU=e.wrapModeU,r.wrapModeV=e.wrapModeV,r.filterMode=e.filterMode,r.anisoLevel=e.anisoLevel),r._format){case 0:case 1:r.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:r.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return r},Texture2D.load=function(t,e){i.loader.create(t,e,null,"TEXTURE2D")},Texture2D.grayTexture=null,Texture2D}(),Ot=function(t){function RenderTexture2D(t,e,i,r){this._mgrKey=0,void 0===i&&(i=0),void 0===r&&(r=0),RenderTexture2D.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=r,this._create(t,e),this.lock=!0}n(RenderTexture2D,"laya.webgl.resource.RenderTexture2D",It);var e=RenderTexture2D.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var i=lt.instance;this._frameBuffer=i.createFramebuffer(),j.bindTexture(i,this._glTextureType,this._glTexture);var r=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,r,t,e,0,r,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,lt.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=lt.instance;lt.instance.bindFramebuffer(36160,this._frameBuffer),this._lastRT=RenderTexture2D._currentActive,RenderTexture2D._currentActive=this,this._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=W.width,this._lastHeight=W.height,W.width=this._width,W.height=this._height,Dt.activeShader=null},e.end=function(){lt.instance.bindFramebuffer(36160,null),RenderTexture2D._currentActive=null,this._readyed=!0},e.restore=function(){var t=lt.instance;this._lastRT!=RenderTexture2D._currentActive&&(lt.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),RenderTexture2D._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),W.width=this._lastWidth,W.height=this._lastHeight,Dt.activeShader=null},e.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1);var n=lt.instance;n.clearColor(t,e,i,r);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}n.clear(a)},e.getData=function(t,e,i,r){if(m.isConchApp&&2==conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var n=lt.instance;if(n.bindFramebuffer(36160,this._frameBuffer),!(36053===n.checkFramebufferStatus(36160)))return n.bindFramebuffer(36160,null),null;var a=new Uint8Array(this._width*this._height*4),s=this._getGLFormat();return n.readPixels(t,e,i,r,s,5121,a),n.bindFramebuffer(36160,null),a},e.getDataAsync=function(t,e,i,r,n){var a=lt.instance;a.bindFramebuffer(36160,this._frameBuffer),a.readPixelsAsync(t,e,i,r,6408,5121,function(t){n(new Uint8Array(t))}),a.bindFramebuffer(36160,null)},e.recycle=function(){},e._disposeResource=function(){if(this._frameBuffer){var t=lt.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},a(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,e,"defaulteTexture",function(){return Pt.grayTexture}),a(0,e,"sourceWidth",function(){return this._width}),a(0,e,"sourceHeight",function(){return this._height}),a(0,e,"offsetX",function(){return 0}),a(0,e,"offsetY",function(){return 0}),a(1,RenderTexture2D,"currentActive",function(){return RenderTexture2D._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive),RenderTexture2D.pushRT=function(){RenderTexture2D.rtStack.push({rt:RenderTexture2D._currentActive,w:W.width,h:W.height})},RenderTexture2D.popRT=function(){var t=lt.instance,e=RenderTexture2D.rtStack.pop();e&&(RenderTexture2D._currentActive!=e.rt&&(lt.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),RenderTexture2D._currentActive=e.rt),t.viewport(0,0,e.w,e.h),W.width=e.w,W.height=e.h)},RenderTexture2D._currentActive=null,RenderTexture2D.rtStack=[],r(RenderTexture2D,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),RenderTexture2D}(),Nt=function(t){function Shader2X(t,e,i,r,n){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,Shader2X.__super.call(this,t,e,i,r,n)}n(Shader2X,"laya.webgl.shader.d2.Shader2X",t);var e=Shader2X.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},Shader2X.create=function(t,e,i,r,n){return new Shader2X(t,e,i,r,n)},Shader2X}(Wt);i.__init([_t,pt])}(window,document,Laya);